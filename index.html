<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bilgi Ağacı - 지식의 나무</title>

    <link rel="icon" type="image/ico" href="images/oyun-ikonu.ico">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />

    <style>

#loader-wrapper {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 9999;
    background-image: url('images/intro-bg.png'); 
    background-size: contain; 
    background-position: center;
    background-repeat: no-repeat;
    background-color: #79A6DC;
    display: flex;
 flex-direction: column;
 justify-content: center;
 align-items: center;
 opacity: 1;
 transition: opacity 0.8s ease-out;
}


#loader-text {
    position: absolute;
    bottom: calc(06% + 25px); 
    left: 50%;
    transform: translateX(-50%);
    color: white;
    font-size: 1.5em;
    font-weight: bold;
    text-shadow: 1px 1px 4px rgba(0, 0, 0, 0.5);
}
#loader-wrapper.hidden {
    opacity: 0;
    pointer-events: none; 
}

    body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    margin: 0;
    padding: 0;
    background-image: url('images/ana sayfa.png');
    background-size: cover; 
    background-position: center; 
    background-repeat: no-repeat; 
    background-attachment: fixed; 
    
    color: #333;
    overflow-x: hidden;
}

    .container {
    width: 100%;
    max-width: 600px;
    padding: 20px;
    box-sizing: border-box;
    position: relative;
    margin: 10vh auto 0; 
    opacity: 0;
    transition: opacity 0.5s ease-in;
}

#loader-bar-container {
    position: absolute;
    bottom: 06%; 
    width: 70%;
    max-width: 400px;
    height: 15px;
    background-color: rgba(0, 0, 0, 0.3);
    border-radius: 10px;
    overflow: hidden; 
    border: 1px solid rgba(255, 255, 255, 0.2);
    box-shadow: 0 0 10px rgba(0,0,0,0.5);
}

#loader-bar-fill {
    width: 0%; 
    height: 100%;
    background-color: #ffffff;
    border-radius: 10px;
    animation: fill-bar 3s linear forwards;
}

@keyframes fill-bar {
    from {
        width: 0%;
    }
    to {
        width: 100%;
    }
}

        .game-button {
            background-color: #f0f0f0;
            color: #333;
            padding: 15px 20px;
            margin: 8px 0;
            border-radius: 8px;
            font-size: 1em;
            text-decoration: none;
            display: block;
            text-align: center;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s, opacity 0.3s;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            border: 1px solid #e0e0e0;
            width: 100%;
            box-sizing: border-box;
        }

        .game-button:hover:not(:disabled) {
            background-color: #e5e5e5;
            transform: translateY(-1px);
        }

        .game-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .game-button.small-btn {
            font-size: 0.9em;
            padding: 10px 15px;
            margin: 5px;
            width: auto;
            display: inline-block;
        }

        .difficulty-btn.active {
            background-color: #007bff;
            color: white;
            border-color: #0056b3;
        }

        

        #categorySelectionScreen {
            display: none;
        }

        #categorySelectionScreen h2 {
            font-size: 1.8em;
            font-weight: 600;
            color: #34495e;
            padding-bottom: 15px;
            margin-bottom: 25px;
            border-bottom: 1px solid #e0e0e0;
            letter-spacing: 1px;
        }

        .game-title {
    font-size: 2.3em;
    font-weight: bold;
    color: #ffffff; 
    text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.6); 
    margin-bottom: 5px;
}

        .game-subtitle {
    font-size: 0.8em;
    color: #eeeeee; 
    text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5); 
    margin-top: 0px;
    margin-bottom: 25px;
    font-weight: normal;
}

#difficultySelection h3 {
    margin-top:0; 
    margin-bottom:10px; 
    color: #ffffff; 
    text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5); 
}

        .tagline {
            background-color: #f0f0f0;
            color: #555;
            padding: 15px 20px;
            margin-top: 12px;
            border-radius: 8px;
            font-size: 1em;
            text-align: center;
            display: block;
            width: 100%;
            box-sizing: border-box;
            border: 1px solid #e0e0e0;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .tree-emoji-corner {
            position: absolute;
            top: 20px;
            left: 25px;
            font-size: 3.5em;
            opacity: 0.5;
            line-height: 1;
            z-index: 0;
        }

        .category-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .category-card {
            position: relative;
            overflow: hidden;
            background-size: cover;
            background-position: center;
            border: 1px solid #dee2e6;
            border-radius: 12px;
            min-height: 120px;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .category-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.12);
        }

        .category-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.45);
            border-radius: 12px;
            transition: background-color 0.3s ease;
        }

        .category-card:hover::before {
            background-color: rgba(0, 0, 0, 0.25);
        }

        .category-card span {
            position: relative;
            z-index: 1;
            color: white;
            font-weight: bold;
            font-size: 1.1em;
            text-shadow: 1px 1px 4px rgba(0, 0, 0, 0.8);
            padding: 5px;
        }

        .question-page-container {
    
    width: 100%;
    height: 100%;
    box-sizing: border-box; 

    display: flex;
    flex-direction: column;
    justify-content: center; 

   
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    transition: background-image 0.5s ease-in-out;
    
    padding: env(safe-area-inset-top, 20px) 20px env(safe-area-inset-bottom, 20px);
}

#howToPlayModal .modal-content,
#creditsModal .modal-content,
#privacyModal .modal-content {
    background-color: #fefefe;
    border: 1px solid #ccc;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    color: #333;
    text-align: center;
}

#howToPlayModal h4 {
    margin-top: 20px;
    margin-bottom: 10px;
    color: #007bff;
}

#howToPlayModal ul {
    list-style-type: none;
    padding-left: 0;
}

#howToPlayModal li {
    background-color: #f8f9fa;
    padding: 10px;
    border-radius: 5px;
    margin-bottom: 8px;
    border-left: 4px solid #007bff;
}

        .category-default-bg {
            background-color: #ffffff;
            background-image: none;
        }

        .question-page-container::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.10);
            z-index: -1;
            border-radius: 15px;
            pointer-events: none;
            transition: background-color 0.5s ease-in-out;
        }

        .quiz-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 5px;
        }

        #masterTimerDisplay {
            font-size: 1.4em;
            font-weight: bold;
            color: #007bff;
            background-color: rgba(240, 240, 240, 0.8);
            padding: 5px 10px;
            border-radius: 8px;
        }

        .timer-display {
            font-size: 1.3em;
            font-weight: bold;
            color: #e74c3c;
            background-color: rgba(240, 240, 240, 0.8);
            padding: 5px 10px;
            border-radius: 8px;
        }

        .category-info-text,
        .score-info-text,
        .streak-info-text {
            background-color: rgba(240, 240, 240, 0.8);
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 0.85em;
            font-weight: 500;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .category-info-text .icon,
        .score-info-text .icon,
        .streak-info-text .icon {
            font-size: 1.1em;
            margin-right: 5px;
            vertical-align: middle;
        }

        .question-area {
            background-color: rgba(233, 242, 249, 0.85);
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 10px;
            text-align: center;
            min-height: 70px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .question-text {
            font-size: 1.4em;
            font-weight: 600;
            color: #2c3e50;
        }

        .answer-options {
            display: grid;
            grid-template-columns: 1fr;
            gap: 8px;
            margin-bottom: 20px;
        }

        .answer-btn {
            background-color: #f0f0f0;
            border: 1px solid #e0e0e0;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 0.95em;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.2s, border-color 0.2s;
            text-align: left;
            width: 100%;
            box-sizing: border-box;
            color: #333;
        }

        .answer-btn:hover:not(:disabled) {
            background-color: #e5e5e5;
        }

        .answer-btn:disabled {
            cursor: not-allowed;
            opacity: 0.7;
        }

        .answer-btn.correct {
            background-color: #28a745 !important;
            color: white !important;
            border-color: #1e7e34 !important;
            animation: pulseCorrect 0.6s ease-out;
        }

        @keyframes pulseCorrect {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.08);
                box-shadow: 0 0 15px #28a745;
            }

            100% {
                transform: scale(1);
            }
        }

        .answer-btn.incorrect {
            background-color: #dc3545 !important;
            color: white !important;
            border-color: #b21f2d !important;
            animation: shakeIncorrect 0.5s ease-in-out;
        }

        @keyframes shakeIncorrect {
            0%,
            100% {
                transform: translateX(0);
            }

            20%,
            60% {
                transform: translateX(-8px);
            }

            40%,
            80% {
                transform: translateX(8px);
            }
        }

        .explanation-area,
        .hint-area {
            margin-top: 15px;
            padding: 15px;
            background-color: rgba(233, 236, 239, 0.85);
            border: 1px solid #ced4da;
            border-radius: 5px;
            color: #495057;
            text-align: center;
            font-style: italic;
            margin-bottom: 15px;
        }

        #nextQuestionBtn {
            background-color: #007bff;
            color: white;
            padding: 10px 25px;
            border-radius: 8px;
            font-size: 1.1em;
            text-decoration: none;
            display: block;
            text-align: center;
            cursor: pointer;
            transition: background-color 0.3s;
            border: none;
            margin: 15px auto 0;
            width: auto;
        }

        #nextQuestionBtn:hover {
            background-color: #0056b3;
        }

        .jokers-area {
            display: flex;
            justify-content: space-around;
            align-items: stretch;
            margin-top: 15px;
            margin-bottom: 20px;
            gap: 8px;
        }

        .joker-btn {
            background-color: #f7f7f7;
            border: 1px solid #dddddd;
            padding: 8px 5px;
            border-radius: 6px;
            font-size: 0.8em;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 85px;
            height: 70px;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
            transition: background-color 0.2s, transform 0.1s, opacity 0.3s, filter 0.3s;
            text-align: center;
            color: #333333;
        }

        .joker-btn .icon {
            font-size: 2.4em;
            margin-bottom: 4px;
            line-height: 1;
        }

        .joker-btn .joker-info-line {
            font-size: 0.9em;
            line-height: 1.15;
            display: block;
        }

        .joker-btn:hover:not(:disabled) {
            background-color: #e9e9e9;
            transform: translateY(-1px);
        }

        .joker-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background-color: #f0f0f0 !important;
            filter: grayscale(50%);
        }

        .joker-btn.joker-used {
            opacity: 0.4 !important;
            filter: grayscale(80%) !important;
            cursor: not-allowed;
        }

        .modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto; 
    background-color: rgba(0, 0, 0, 0.6);
}

       .modal-content {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    
    padding: 25px;
    width: 90%;
    max-width: 500px;
    border-radius: 10px;
}

#achievementsModal .modal-content, 
#dailyRewardModal .modal-content {
     background-color: #fefefe;
     border: 1px solid #888;
     box-shadow: 0 5px 15px rgba(0,0,0,0.3);
}




        .modal-content h2 {
            margin-top: 0;
            color: #333;
            text-align: center;
        }

        .close-btn {
            color: #aaa;
            position: absolute;
            right: 15px;
            top: 10px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close-btn:hover,
        .close-btn:focus {
            color: black;
            text-decoration: none;
        }

        #highScoresList,
#achievementsList {
    list-style-type: none;
    padding: 0;
    border: 1px solid #ddd;
    border-radius: 8px;
    background-color: #fdfdfd;
    max-height: 380px;
    overflow-y: auto;
}

#highScoresList {
    flex-grow: 1;
    flex-basis: 0;
    min-height: 350px; 
    margin: 0;
    padding: 5px;
}

        #highScoresList li,
        #achievementsList li {
            padding: 12px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background-color 0.2s;
            border-bottom: 1px solid #eee;
        }

        #highScoresList li:last-child,
        #achievementsList li:last-child {
            border-bottom: none;
        }

        #highScoresList li:nth-child(even) {
            background-color: #f7f7f7;
        }

        #highScoresList li:hover {
            background-color: #e9f5ff;
        }

        #highScoresList .score-rank {
            font-weight: bold;
            color: #333;
            margin-right: 15px;
            font-size: 1.1em;
            min-width: 40px;
            text-align: center;
        }

        #highScoresList .score-rank {
    display: flex;
    align-items: center;
    justify-content: flex-start;
    min-width: 80px;
    margin-right: 10px;
    position: relative; 
}

.score-avatar-img {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    object-fit: cover;
    border: 2px solid #ddd; 
}

.score-rank-number {
    font-weight: bold;
    font-size: 1.1em;
    color: #333;
    margin-left: 18px; 
}

#highScoresList li:nth-child(1) .score-avatar-img {
    border-color: #D4AF37; 
}
#highScoresList li:nth-child(2) .score-avatar-img {
    border-color: #C0C0C0; 
}
#highScoresList li:nth-child(3) .score-avatar-img {
    border-color: #CD7F32; 
}

#highScoresList li:nth-child(1) .score-rank-number {
    color: #D4AF37;
}

#highScoresList li:nth-child(1) .score-rank::after,
#highScoresList li:nth-child(2) .score-rank::after,
#highScoresList li:nth-child(3) .score-rank::after {
    position: absolute;
    bottom: -8px;
    left: 10px;
    font-size: 1.4em;
    text-shadow: 0px 0px 5px rgba(0, 0, 0, 0.5);
    line-height: 1;
}

#highScoresList li:nth-child(1) .score-rank::after {
    content: '🥇';
}
#highScoresList li:nth-child(2) .score-rank::after {
    content: '🥈';
}
#highScoresList li:nth-child(3) .score-rank::after {
    content: '🥉';
}

        #highScoresList .score-name {
            font-weight: 600;
            flex-grow: 1;
            color: #2c3e50;
        }

        #highScoresList .score-value {
            color: #007bff;
            font-weight: bold;
            font-size: 1.1em;
            background-color: #e9f5ff;
            padding: 4px 8px;
            border-radius: 5px;
        }

        #achievementsList .achievement-icon {
            font-size: 1.8em;
            margin-right: 10px;
            min-width: 30px;
            text-align: center;
        }

        #achievementsList .achievement-details {
            flex-grow: 1;
        }

        #achievementsList .achievement-name {
            font-weight: bold;
            display: block;
            font-size: 0.95em;
        }

        #achievementsList .achievement-desc {
            font-size: 0.8em;
            color: #555;
        }

        #achievementsList .achievement-date {
            font-size: 0.75em;
            color: #007bff;
            white-space: nowrap;
            margin-left: 10px;
        }

        #achievementsList li.unlocked .achievement-icon {
            color: gold;
        }

        #achievementsList li.locked {
            opacity: 0.6;
        }

        #achievementsList li.locked .achievement-icon {
            color: #ccc;
        }

        #achievementsList li.locked .achievement-name,
        #achievementsList li.locked .achievement-desc {
            color: #999;
        }


.achievement-icon-large {
    font-size: 4.5em; 
    line-height: 1;
    margin-bottom: 12px;
}

.achievement-title-main {
    font-weight: bold;
    font-size: 1.1em; 
}

.achievement-name-specific {
    font-size: 1em; 
    font-style: italic;
    margin-top: 4px;
    opacity: 0.9;
}

        #achievementUnlockedPopup {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) scale(0.7);
    
    width: 220px; 
    height: 220px;
    box-sizing: border-box; 

    background-color: #28a745;
    color: white;
    padding: 20px; 
    border-radius: 20px; 
    box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
    z-index: 1005;
    font-size: 1.2em;
    opacity: 0;
    transition: opacity 0.4s ease-out, transform 0.4s ease-out;

    display: none; 
    flex-direction: column;
    justify-content: center; 
    align-items: center;     
    text-align: center;

    pointer-events: none;
}

#achievementUnlockedPopup.show {
    display: flex;
    opacity: 1;
    transform: translate(-50%, -50%) scale(1);
}

        #saveScoreSection input[type="text"] {
            width: calc(100% - 130px);
            padding: 10px;
            margin-right: 10px;
            border-radius: 5px;
            border: 1px solid #ccc;
            box-sizing: border-box;
            font-size: 0.9em;
        }

        #saveScoreSection button {
            width: 120px;
            display: inline-block;
            padding: 10px;
            font-size: 0.9em;
            margin: 0;
        }

        #settingsModal label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        #settingsModal input[type="range"] {
            width: calc(100% - 80px);
            margin-right: 10px;
            vertical-align: middle;
        }

        #settingsModal .volume-value {
            display: inline-block;
            width: 30px;
            text-align: right;
        }

        #settingsModal input[type="checkbox"] {
            vertical-align: middle;
        }

        #settingsModal div {
            margin-bottom: 15px;
        }

        #notificationPopup {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 12px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            z-index: 1010;
            font-size: 1em;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.4s, top 0.4s;
            display: none;
            text-align: center;
            color: white;
            font-weight: 500;
        }

        #notificationPopup.show {
            display: block;
            opacity: 1;
            top: 40px;
        }

        #notificationPopup.success {
            background-color: #28a745;
        }

        #notificationPopup.error {
            background-color: #dc3545;
        }

        #notificationPopup.info {
            background-color: #17a2b8;
        }

        .bg-tarih {
            background-image: url('images/tarih.jpg');
        }

        .bg-bilim-ve-teknoloji {
            background-image: url('images/bilim.jpg');
        }

        .bg-cografya {
            background-image: url('images/cografya.jpg');
        }

        .bg-sanat {
            background-image: url('images/sanat.jpg');
        }

        .bg-spor {
            background-image: url('images/spor.jpg');
        }

        .bg-edebiyat {
            background-image: url('images/edebiyat.jpg');
        }

        .bg-matematik {
            background-image: url('images/matematik.jpg');
        }

        .bg-felsefe {
            background-image: url('images/felsefe.jpg');
        }

        .bg-mitoloji {
            background-image: url('images/mitoloji.jpg');
        }

        .bg-sinema {
            background-image: url('images/sinema.jpg');
        }

        .bg-muzik {
            background-image: url('images/muzik.jpg');
        }

        .bg-doga {
            background-image: url('images/doga.jpg');
        }

        .bg-genel-kultur {
            background-image: url('images/genel-kultur.jpg');
        }

        .bg-guncel {
            background-image: url('images/guncel.jpg');
        }

        .qs-bg-cografya {
            background-image: url('images/açık mint yeşili.png');
        }

        .qs-bg-tarih {
            background-image: url('images/duman grisi.png');
        }

        .qs-bg-bilim-ve-teknoloji {
            background-image: url('images/mavi.png');
        }

        .qs-bg-sanat {
            background-image: url('images/lila.png');
        }

        .qs-bg-edebiyat {
            background-image: url('images/turuncu.png');
        }

        .qs-bg-sinema {
            background-image: url('images/fuşya.png');
        }

        .qs-bg-muzik {
            background-image: url('images/sarı.png');
        }

        .qs-bg-spor {
            background-image: url('images/zeytin.png');
        }

        .qs-bg-matematik {
            background-image: url('images/siyah.png');
        }

        .qs-bg-felsefe {
            background-image: url('images/indigo.png');
        }

        .qs-bg-mitoloji {
            background-image: url('images/pembe.png');
        }

        .qs-bg-doga {
            background-image: url('images/yeşil.png');
        }

        .qs-bg-genel-kultur {
            background-image: url('images/turkuaz.png');
        }

        .qs-bg-guncel {
            background-image: url('images/kırmızı.png');
        }

        .bg-default::before {
            background-color: rgba(255, 255, 255, 1) !important;
        }

        .player-stats-bar {
            position: absolute;
            top: 15px;
            right: 20px;
            display: flex;
            gap: 15px;
            z-index: 10;
            background-color: rgba(0, 0, 0, 0.1);
            padding: 5px 10px;
            border-radius: 20px;
        }

        .stat-item {
            display: flex;
            align-items: center;
            color: #333;
            font-weight: bold;
            font-size: 1.1em;
            text-shadow: none;
        }

        .stat-item .icon {
            font-size: 1.5em;
            margin-right: 5px;
        }

        .shop-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .shop-item {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            text-align: center;
        }

        .shop-item span {
            font-weight: 500;
            margin-bottom: 10px;
        }

        

        #usernameInput {
            width: 100%;
            padding: 8px;
            font-size: 1.1em;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box;
        }

        #userIDDisplay {
            font-family: 'Courier New', Courier, monospace;
            background-color: #f0f0f0;
            padding: 5px 8px;
            border-radius: 5px;
            font-size: 0.9em;
            color: #333;
        }

        #avatarSelection {
            margin-bottom: 15px;
        }

        .avatar-grid {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .avatar-option {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            cursor: pointer;
            border: 3px solid transparent;
            transition: border-color 0.2s;
        }

        .avatar-option:hover,
        .avatar-option.selected {
            border-color: #007bff;
        }

        
       

#profileModal .modal-content.profile-redesign {
    background: rgba(255, 255, 255, 0.2); 
    backdrop-filter: blur(10px);          
    -webkit-backdrop-filter: blur(10px);
    border-radius: 16px;                  
    border: 1px solid rgba(255, 255, 255, 0.3); 
    box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);  
    padding: 0;
    overflow: hidden;
}

#profileModal #usernameInput,
#profileModal #userIDDisplay,
#profileModal .tab-btn,
#profileModal .achievement-name,
#profileModal #profile-stats-content h4,
#profileModal #profile-stats-content p[data-translate-key] {
    color: #ffffff;
    text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.8); 
}

#profileModal .tab-btn,
#profileModal #userIDDisplay { 
    color: black;
    text-shadow: none; 
}

#profileModal .achievement-desc {
    color: #e0e0e0; 
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.7);
}

#profileModal .tab-btn.active {
    border-bottom: 3px solid #FFC107; 
}

#profileModal .achievement-item {
    background-color: rgba(0, 0, 0, 0.15); 
    box-shadow: none; 
    border-bottom: 1px solid rgba(255, 255, 255, 0.1); 
    border-radius: 8px;
}

#profileModal .progress-bar-container {
    background-color: rgba(0, 0, 0, 0.2); 
}


.profile-pic-edit-overlay {
    background-color: rgba(255, 255, 255, 0.8); 
}

.profile-banner {
    width: 100%;
    height: 200px; 
    background-image: url('images/profile-bg.png');
    background-size: cover;
    background-position: center;
}

.profile-pic-wrapper {
    position: relative; 
    width: 110px;
    height: 110px;
    margin: -60px auto 0 auto;
    border-radius: 50%;
    cursor: pointer;
}

#profilePic {
    width: 100%;
    height: 100%;
    border-radius: 50%;
    border: 5px solid white;
    object-fit: cover;
    box-shadow: 0 4px 10px rgba(0,0,0,0.2);
}

.profile-pic-edit-overlay {
    position: absolute;
    bottom: 5px;
    right: 5px;
    width: 30px;
    height: 30px;
    background-color: white;
    color: #333;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.1em;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    transition: transform 0.2s;
}

.profile-pic-wrapper:hover .profile-pic-edit-overlay {
    transform: scale(1.1);
}

.profile-user-info {
    text-align: center;
    padding: 15px 0; 
}

#usernameInput {
    font-size: 1.6em;
    font-weight: bold;
    color: #333;
    border: none;
    background: transparent;
    padding: 2px 5px;
    text-align: center;
    width: 100%;
    box-sizing: border-box;
}

#userIDDisplay {
    font-family: 'Courier New', Courier, monospace;
    font-size: 0.9em;
    color: #888;
}

.profile-tabs {
    display: flex;
    justify-content: center;
    margin-top: 20px; 
    background-color: rgba(0, 0, 0, 0.2); 
    border-radius: 50px; 
    padding: 5px;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.tab-btn {
    flex-grow: 1; 
    background: transparent;
    border: none;
    color: #e0e0e0;
    padding: 10px 15px;
    border-radius: 50px;
    font-size: 1em;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s ease;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.4);
}

.tab-btn:hover:not(.active) {
    background-color: rgba(255, 255, 255, 0.1);
    color: #ffffff;
}

.tab-btn.active {
    background-color: #ffffff;
    color: #0056b3; 
    text-shadow: none;
    box-shadow: 0 2px 10px rgba(0,0,0,0.2);
    transform: scale(1.02);
}

.profile-content-wrapper {
    padding: 15px;
}
.tab-content { display: none; }
.tab-content.active { display: block; }

#profileAchievementsList {
   list-style-type: none;
   padding: 0;
   max-height: 400px;
   overflow-y: auto;
   text-align: left;
}

.achievement-item {
    background-color: #ffffff;
    border-radius: 12px;
    padding: 15px;
    margin-bottom: 10px;
    display: flex;
    align-items: center;
    gap: 15px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
}

.achievement-item .achievement-icon {
    font-size: 2.5em;
    flex-shrink: 0;
    width: 50px;
    text-align: center;
}

.achievement-item .achievement-details {
    flex-grow: 1;
}

.achievement-item .achievement-name {
    font-weight: bold;
    font-size: 1em;
    display: block;
    margin-bottom: 4px;
}

.achievement-item .achievement-desc {
    font-size: 0.85em;
    color: #666;
    margin-bottom: 10px;
}

.progress-bar-container {
    width: 100%;
    height: 10px;
    background-color: #e9ecef;
    border-radius: 5px;
    overflow: hidden;
}

.progress-bar {
    width: var(--progress-percent, 0%);
    height: 100%;
    background: #FFC107;
    border-radius: 5px;
    transition: width 0.4s ease-in-out;
}

.achievement-item.locked {
    opacity: 0.6;
}

.achievement-item.locked .achievement-icon {
    filter: grayscale(100%);
}

.achievement-item.locked .progress-bar {
    background-color: #d0d0d0;
}

.swiper-container {
    position: relative;
    width: 100%;
    overflow: hidden; 
    padding: 10px 0 25px 0;
    margin-bottom: 10px;
}

.swiper-wrapper {
    display: flex;
    transition: transform 0.4s ease-in-out; 
}

.swiper-slide {
    flex: 0 0 100%; 
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 0 40px; 
    box-sizing: border-box;
}

.swiper-slide .game-button.swiper-mode-btn {
    width: 100%;
    max-width: 250px; 
    margin: 0;
    cursor: default; 
    pointer-events: none; 
}

.swiper-nav {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background-color: rgba(0, 0, 0, 0.2);
    color: white;
    border: none;
    border-radius: 50%;
    width: 30px;
    height: 30px;
    font-size: 20px;
    line-height: 30px;
    text-align: center;
    cursor: pointer;
    z-index: 10;
    transition: background-color 0.2s;
}
.swiper-nav:hover {
    background-color: rgba(0, 0, 0, 0.4);
}
.swiper-nav.prev {
    left: 5px;
}
.swiper-nav.next {
    right: 5px;
}
.swiper-nav.hidden {
    display: none; 
}

.swiper-dots {
    text-align: center;
    position: absolute;
    bottom: 5px; 
    width: 100%;
}
.dot {
    display: inline-block;
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background-color: #ccc;
    margin: 0 4px;
    cursor: pointer;
    transition: background-color 0.3s;
}
.dot.active {
    background-color: #007bff;
}

#scoreboardModal .modal-content {
    min-height: 500px; 
    display: flex;
    flex-direction: column;
}


.settings-menu {
    display: flex;
    flex-direction: column;
    gap: 15px; 
}


.settings-menu-btn .fa-language {
    color: #3498db; 
}

.settings-menu-btn .fa-volume-up {
    color: #2ecc71; 
}

.settings-menu-btn .fa-database {
    color: #e67e22; 
}

.settings-menu-btn {
    display: flex;
    align-items: center;
    justify-content: flex-start; 
    text-align: left;
    padding-left: 20px;
}

.settings-menu-btn i {
    font-size: 1.2em;
    margin-right: 15px;
    width: 25px; 
    text-align: center;
}

.settings-view-header {
    display: flex;
    align-items: center;
    margin-bottom: 25px;
    border-bottom: 1px solid #eee;
    padding-bottom: 15px;
}

.settings-back-btn {
    background: none;
    border: 1px solid #ccc;
    border-radius: 50%;
    width: 35px;
    height: 35px;
    cursor: pointer;
    margin-right: 15px;
    font-size: 1em;
    color: #555;
    transition: background-color 0.2s;
}

.settings-back-btn:hover {
    background-color: #f0f0f0;
}

.settings-view-header h3 {
    margin: 0;
    font-size: 1.4em;
}


.language-selection-container {
   display: flex;
   justify-content: center;
   flex-wrap: wrap; 
   gap: 15px; 
   margin-top: 20px;
}

.lang-option-label input[type="radio"] {
    position: absolute;
    opacity: 0;
    width: 0;
    height: 0;
}

.lang-option-content {
    display: flex;
    align-items: center;
    padding: 12px 25px;
    background-color: #ffffff;
    border: 2px solid #e0e0e0;
    border-radius: 50px; 
    cursor: pointer;
    transition: all 0.2s ease-in-out;
    box-shadow: 0 2px 5px rgba(0,0,0,0.05);
}

.lang-option-label:hover .lang-option-content {
    border-color: #ccc;
    transform: translateY(-2px);
}

.lang-flag-img {
    width: 32px;  
    height: 24px; 
    margin-right: 12px;
    border-radius: 4px; 
    border: 1px solid #ccc;
}

.lang-name {
    font-size: 1.1em;
    font-weight: 600;
    color: #333;
}

.lang-option-label input[type="radio"]:checked + .lang-option-content {
    border-color: #FFC107; 
    box-shadow: 0 4px 15px rgba(255, 193, 7, 0.4); 
    transform: scale(1.05); 
}


#shopModal .modal-content.shop-reimagined {
    background-color: #F0F5FF; 
    padding: 15px;
    max-height: 90vh; 
    overflow-y: auto;
}

#shopModal .shop-reimagined h2 {
    text-align: center;
    font-size: 2em;
    color: #34495e;
    margin-bottom: 5px;
}

.shop-resource-bar {
    position: absolute; 
    top: 15px;          
    right: 15px;        
    z-index: 10;        
    display: flex;
    align-items: center;
    gap: 10px; 
}

.resource-item {
    display: flex;
    align-items: center;
    background-color: rgba(0, 0, 0, 0.05);
    padding: 4px 12px;
    border-radius: 15px;
    font-size: 1.0em;
    font-weight: bold;
    color: #333; 
}

.resource-item .resource-icon {
    font-size: 1.4em;
    margin-right: 8px; 
    line-height: 1;
}

.shop-section {
    margin-bottom: 30px;
}

.shop-section-header {
    position: relative;
    padding: 8px 20px;
    margin-bottom: 15px;
    border-radius: 50px;
    text-align: center;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
}

.shop-section-header h4 {
    margin: 0;
    color: white;
    font-size: 1.3em;
    font-weight: bold;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
}

.header-watch-earn { background: linear-gradient(45deg, #28a745, #218838); }
.header-jokers { background: linear-gradient(45deg, #9b59b6, #8e44ad); }
.header-lives { background: linear-gradient(45deg, #e74c3c, #c0392b); }


.watch-and-earn-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px;
}
.watch-ad-card {
    background-color: #fff;
    border-radius: 15px;
    padding: 15px;
    text-align: center;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    box-shadow: 0 5px 15px rgba(0,0,0,0.08);
    border: 1px solid #e0e0e0;
}
.watch-ad-icon {
    font-size: 2.5em;
    line-height: 1;
}
.watch-ad-title {
    font-weight: bold;
    font-size: 1.1em;
    margin-top: 10px;
    color: #333;
}
.watch-ad-desc {
    font-size: 0.9em;
    color: #007bff;
    margin-top: 4px;
    margin-bottom: 12px;
}
.watch-ad-btn {
    width: 80%;
}
.watch-ad-btn:disabled {
    background-color: #bdc3c7 !important;
    cursor: not-allowed;
}

.shop-item-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
    gap: 15px;
}
.shop-item-card {
    background: #ffffff;
    border-radius: 15px;
    padding: 20px 10px 15px 10px;
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    box-shadow: 0 5px 15px rgba(0,0,0,0.08);
    border: 1px solid #e0e0e0;
    position: relative; 
    overflow: hidden; 
}

.shop-item-icon {
    font-size: 2.8em;
    margin-bottom: 12px;
}

.shop-item-name {
    font-size: 0.95em;
    font-weight: 500;
    color: #333;
    flex-grow: 1; 
    margin-bottom: 10px;
}

.shop-item-card .buy-btn {
    width: 90%;
    margin-top: auto; 
}

.shop-item-card.popular {
    border: 2px solid #ffc107;
}
.popular-tag {
    position: absolute;
    top: 10px;
    right: -30px;
    background-color: #ffc107;
    color: #333;
    padding: 4px 30px;
    font-size: 0.75em;
    font-weight: bold;
    transform: rotate(45deg);
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
}


.shop-item-card.unlimited {
    border-color: #8e44ad; 
}

.shop-item-card.unlimited .shop-item-icon {
    color: #8e44ad;
}

.shop-item-icon sub {
    font-size: 0.5em; 
    vertical-align: middle; 
}

#playerLives, #shopLivesDisplay {
    font-size: 0.9em; 
}


.daily-reward-container {
    background-color: #f4f7fc;
    text-align: center;
}

.daily-reward-subtitle {
    font-size: 0.9em;
    color: #667;
    margin-top: -10px;
    margin-bottom: 25px;
}

.daily-reward-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 10px;
    margin-bottom: 25px;
}

.reward-card {
    background: #fff;
    border: 2px solid #e0e6ed;
    border-radius: 12px;
    padding: 10px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: space-between;
    min-height: 130px;
    transition: all 0.2s ease-in-out;
    position: relative;
    overflow: hidden;
}

.reward-card .day-label {
    font-size: 0.8em;
    font-weight: bold;
    color: #fff;
    background-color: #6c757d;
    padding: 2px 10px;
    border-radius: 10px;
    position: absolute;
    top: 8px;
    left: 8px;
}

.reward-card .reward-icon {
    font-size: 2.5em;
    margin-top: 30px;
    line-height: 1;
}

.reward-card .reward-text {
    font-size: 0.85em;
    font-weight: 500;
    margin-top: 8px;
    color: #333;
}

.reward-card.active {
    border-color: #007bff;
    transform: translateY(-5px);
    box-shadow: 0 8px 20px rgba(0, 123, 255, 0.2);
}
.reward-card.active .day-label {
    background-color: #007bff;
}

.reward-card.claimed {
    opacity: 0.6;
    background-color: #e9ecef;
}
.reward-card.claimed::after {
    content: '✅';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 4em;
    color: #28a745;
    opacity: 0.3;
}

.reward-card.final-day {
    grid-column: span 4; 
    flex-direction: row;
    background: linear-gradient(45deg, #ffc107, #ff9800);
    color: #333;
    border-color: #ffc107;
}
.reward-card.final-day .day-label {
    background-color: rgba(0,0,0,0.2);
    color: white;
}
.reward-card.final-day .reward-icon {
    font-size: 3.5em;
    margin-top: 0;
}
.reward-card.final-day.active {
    box-shadow: 0 8px 25px rgba(255, 193, 7, 0.4);
}


#rewardDisplayPopup {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) scale(0.7);
    width: 240px;
    height: 240px;
    background-color: #007bff; 
    color: white;
    border-radius: 25px;
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
    z-index: 1006; 
    opacity: 0;
    transition: opacity 0.4s ease-out, transform 0.4s ease-out;
    display: none; 
    flex-direction: column;
    justify-content: center;
    align-items: center;
    text-align: center;
    padding: 20px;
    box-sizing: border-box;
    pointer-events: none;
}

#rewardDisplayPopup.show {
    display: flex; 
    opacity: 1;
    transform: translate(-50%, -50%) scale(1);
}

#rewardDisplayIcon {
    font-size: 5em;
    line-height: 1;
    margin-bottom: 15px;
}

#rewardDisplayTitle {
    font-size: 1.4em;
    font-weight: bold;
}

#rewardDisplayAmount {
    font-size: 1.1em;
    font-weight: 500;
    margin-top: 5px;
    opacity: 0.9;
}

.settings-menu-btn .fa-pencil-alt, 
#submitQuestionBtn .fa-pencil-alt 
{
    color: #3498db;
}

#scoreboardPage .swiper-mode-btn {
    width: 100%;
    max-width: 250px;
    margin: 0;
    pointer-events: none;
    background-color: rgba(255, 255, 255, 0.8);
    color: var(--dark-text);

    font-weight: 700; 
    letter-spacing: 0.5px; 
}


#highScoresList {
    background-color: rgba(0, 0, 0, 0.2); 
    border-color: rgba(255, 255, 255, 0.2);
}

#highScoresList li {
    background-color: transparent !important;
}

#highScoresList .score-rank-number,
#highScoresList .score-name {
    color: #ffffff;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
}

#highScoresList .score-value {
    background-color: rgba(255, 255, 255, 0.8);
    color: #0056b3;
}



#settingsModal .settings-menu-btn {
    background-color: rgba(240, 240, 240, 0.9);
    color: #333;
    text-shadow: none; 
}

#settingsModal .settings-menu-btn .fa-language,
#settingsModal .settings-menu-btn .fa-volume-up,
#settingsModal .settings-menu-btn .fa-database {
    color: inherit; 
}

#settingsModal p[data-translate-key="dangerZoneDesc"] {
    color: #f0f0f0;
}

#categorySelectionScreen,
#questionPage,
#scoreboardPage,
#settingsPage,
#shopPage {
    display: none;
}

.start-screen,
#categorySelectionScreen,
#scoreboardPage,
#settingsPage,
#shopPage,
#profilePage {
    background: rgba(255, 255, 255, 0.2);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border-radius: 16px;
    border: 1px solid rgba(255, 255, 255, 0.3);
    box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
    padding: 30px 25px;
    text-align: center;
    position: relative;
    min-height: 80vh;
    display: flex;
    flex-direction: column;
}

.start-screen h1, .start-screen h3,
#categorySelectionScreen h2,
#scoreboardPage h2,
#settingsPage h2, #settingsPage h3, #settingsPage h4,
#shopPage h2 {
    color: #ffffff;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
}
.start-screen .game-subtitle {
     color: #eeeeee;
     text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5);
}

#scoreboardPage #highScoresList {
    background: rgba(0, 0, 0, 0.2);
    border-color: rgba(255, 255, 255, 0.2);
}
#scoreboardPage #highScoresList li { background: transparent !important; }
#scoreboardPage #highScoresList .score-rank-number,
#scoreboardPage #highScoresList .score-name {
    color: #ffffff;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
}
#scoreboardPage #highScoresList .score-value {
    background-color: rgba(255, 255, 255, 0.8);
    color: #0056b3;
}

#settingsPage label, 
#settingsPage p {
    color: #f0f0f0;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
}
#settingsPage .settings-menu-btn,
#settingsPage .game-button.small-btn {
    background-color: rgba(240, 240, 240, 0.9);
    color: #333;
    text-shadow: none;
}
#settingsPage .settings-back-btn {
    background: rgba(255,255,255,0.2);
    color: white;
}

#settingsModal h2, #settingsModal h3, #settingsModal h4, #settingsModal label {
    color: #ffffff;
    text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.7);
}
#settingsModal p[data-translate-key="dangerZoneDesc"] { color: #f0f0f0; }

body.quiz-active {
    background-image: none !important;
    background-color: #111; 
}

#questionPage {
    position: fixed; 
    top: 0;
    left: 0;
    width: 100vw; 
    height: 100vh; 
    z-index: 100; 
    padding: 0;
    margin: 0;
    display: none; 
}

#shopPage h2 {
    display: flex;
    justify-content: center; 
    align-items: center;     
    margin-top: 40px;        
    margin-bottom: 50px;     
    color: white;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
}

#shopPage h2::before {
    content: '\f07a';
    font-family: 'Font Awesome 6 Free';
    font-weight: 900;
    margin-right: 15px;     
    font-size: 0.9em;
}

#shopPage h2::after {
    content: '\f07a';
    font-family: 'Font Awesome 6 Free';
    font-weight: 900;
    margin-left: 14px;      
    font-size: 0.9em;
}

#profile-stats-content p {
    font-size: 0.9em;
    color: #ffffff; 
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8); 
    margin-top: 0;
    margin-bottom: 20px;
}

#namePromptModal .modal-content {
    background-color: #fefefe;
    max-width: 400px;
    text-align: center;
    border: 1px solid #888;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
}

#namePromptModal h2 {
    color: #007bff;
}

#namePromptModal h4 {
    color: #555;
}

.leaderboard-tabs {
    display: flex;
    justify-content: center;
    margin-bottom: 25px;
    background-color: rgba(0, 0, 0, 0.2);
    border-radius: 50px;
    padding: 5px;
    max-width: 500px;
    margin-left: auto;
    margin-right: auto;
}

.leaderboard-tabs .tab-btn {
    flex-grow: 1; 
    background: transparent;
    border: none;
    color: #e0e0e0;
    padding: 10px 15px;
    border-radius: 50px;
    font-size: 0.9em;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s ease;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.4);
    margin: 0 2px;
}

.leaderboard-tabs .tab-btn:hover {
    background-color: rgba(255, 255, 255, 0.1);
}

.leaderboard-tabs .tab-btn.active {
    background-color: #ffffff;
    color: #0056b3; 
    text-shadow: none;
    box-shadow: 0 2px 10px rgba(0,0,0,0.2);
    transform: scale(1.05);
}

.xp-level-area {
    width: 100%;
    padding: 15px 20px;
    margin-top: 15px;
    margin-bottom: 10px;
    background-color: rgba(0, 0, 0, 0.15);
    border-radius: 12px;
    box-sizing: border-box;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.level-display {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    font-size: 1.3em;
    font-weight: bold;
    color: #FFC107; 
    text-shadow: 1px 1px 3px rgba(0,0,0,0.5);
    margin-bottom: 8px;
}

.xp-bar-container {
    width: 100%;
    height: 12px;
    background-color: rgba(0, 0, 0, 0.3);
    border-radius: 6px;
    overflow: hidden;
}

.xp-bar-fill {
    height: 100%;
    width: 0%; 
    background: linear-gradient(90deg, #4caf50, #81c784);
    border-radius: 6px;
    transition: width 0.5s ease-in-out;
}

.xp-text {
    font-size: 0.8em;
    color: #f0f0f0;
    text-align: center;
    margin-top: 5px;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.7);
}

#profileAchievementsList {
    max-height: 280px;
}

.modal-back-to-settings-btn {
    margin-top: 25px;
    width: 80%;
    margin-left: auto;
    margin-right: auto;
}

    .social-links {
        margin-top: 15px;
        margin-bottom: 15px;
        display: flex;
        justify-content: center;
        gap: 25px;
    }
    .social-links a {
        font-size: 2.5em;
        color: #333;
        transition: transform 0.2s, color 0.2s;
    }
    .social-links a:hover {
        transform: scale(1.1);
    }
    .social-links .youtube:hover {
        color: #FF0000; 
    }
    .social-links .twitter:hover {
        color: #1DA1F2;
    }
    .social-links .email:hover {
        color: #007bff;
    }

    </style>
</head>

<body>
    <div id="loader-wrapper">
    <div class="spinner"></div>
    <div id="loader-text">Yükleniyor...</div>
    
    <div id="loader-bar-container">
        <div id="loader-bar-fill"></div>
    </div>
</div>

    <audio id="clickSound" src="audio/click.wav"></audio>
    <audio id="correctSound" src="audio/correct.wav"></audio>
    <audio id="wrongSound" src="audio/wrong.wav"></audio>
    <audio id="timeUpSound" src="audio/time-up.wav"></audio>
    <audio id="achievementSound" src="audio/achievement.wav"></audio>

    <div class="container" style="opacity: 0; transition: opacity 0.5s ease-in;"></div>
        <div id="startScreen">
            <div class="start-screen">
                <div class="player-stats-bar">
                    <div class="stat-item" id="playerLivesContainer"><span class="icon">❤️</span><span id="playerLives"></span></div>
                    <div class="stat-item" id="playerGoldContainer"><span class="icon">💰</span><span id="playerGold"></span></div>
                </div>
                <div class="tree-emoji-corner">🌳</div>
                <h1 class="game-title" data-translate-key="gameTitle">Bilgi Ağacı</h1>
                <p class="game-subtitle" data-translate-key="koreanSubtitle">(지식의 나무)</p>
                <div id="difficultySelection" style="margin-bottom: 20px; text-align:center;">
                    <h3 style="margin-top:0; margin-bottom:10px;" data-translate-key="difficultySelect">Zorluk Seçin:</h3>
                    <button class="game-button small-btn difficulty-btn" data-difficulty="easy" data-translate-key="difficultyEasy">Kolay</button>
                    <button class="game-button small-btn difficulty-btn active" data-difficulty="medium" data-translate-key="difficultyMedium">Orta</button>
                    <button class="game-button small-btn difficulty-btn" data-difficulty="hard" data-translate-key="difficultyHard">Zor</button>
                </div>
                <button class="game-button" id="startGameBtnClassic" data-translate-key="classicMode">Klasik Mod</button>
                <button class="game-button" id="startTimeAttackBtn" data-translate-key="timeAttackMode">Zamana Karşı</button>
                <button class="game-button" id="startSurvivalBtn" data-translate-key="survivalMode">Hayatta Kalma</button>
                <button class="game-button" id="startCategoryChallengeBtn" data-translate-key="categoryChallengeMode">Kategori Uzmanı</button>
                <hr style="margin: 15px 0;">
                <button class="game-button" id="scoreboardBtn" data-translate-key="scoreboard">Puan Tablosu</button>
                <button class="game-button" id="profileBtn" data-translate-key="profile">Profil 👤</button>
                <button class="game-button" id="settingsBtn" data-translate-key="settings">Ayarlar⚙️ </button>
                <button class="game-button" id="shopBtn" data-translate-key="shop">Mağaza 🛍️</button>
                <div class="tagline" data-translate-key="tagline">🍀 Bilgiye açılan kapınız... 🍀</div>
            </div>
        </div>

        <div id="categorySelectionScreen" style="display:none;">
            <h2 data-translate-key="selectCategory">Kategori Seç</h2>
            <div class="category-grid" id="categoryGrid"></div>
            <div class="special-buttons">
                <button class="game-button" id="backToMenuFromCatSelection" data-translate-key="backToMenu">Ana Menü</button>
            </div>
        </div>

        <div id="questionPage" style="display:none;">
            <div class="question-page-container category-default-bg" id="questionPageContainer">
                <div class="quiz-header">
                    <div id="masterTimerDisplay" style="display:none;">00:00</div>
                    <div class="category-info-text" id="categoryInfo"><span class="icon">🏷️</span> <span data-translate-key="categoryLabel">Kategori:</span> ...</div>
                    <div class="timer-display" id="timerDisplay">15</div>
                    <div class="score-info-text" id="scoreInfo"><span class="icon">⭐</span> <span data-translate-key="scoreLabel">Puan:</span> 0</div>
                    <div class="streak-info-text" id="streakInfo"><span class="icon">🔥</span> <span data-translate-key="streakLabel">Seri:</span> 0 (1x)</div>
                </div>
                <div class="question-area">
                    <p class="question-text" id="questionText" data-translate-key="loadingQuestions">Sorular yükleniyor...</p>
                </div>
                <div class="answer-options" id="answerOptions"></div>
                <div class="hint-area" id="hintArea" style="display:none;"></div>
                <div class="explanation-area" id="explanationArea" style="display:none;"></div>
                <button class="game-button" id="nextQuestionBtn" style="display: none;" data-translate-key="nextQuestion">Sonraki Soru</button>
                <div class="jokers-area" style="display:flex;">
                    <button class="joker-btn" id="joker5050"><span class="icon">🌓</span><span class="joker-info-line"></span></button>
                    <button class="joker-btn" id="jokerTime"><span class="icon">⏳</span><span class="joker-info-line"></span></button>
                    <button class="joker-btn" id="jokerSkip"><span class="icon">⏩</span><span class="joker-info-line"></span></button>
                    <button class="joker-btn" id="jokerHint"><span class="icon">💡</span><span class="joker-info-line"></span></button>
                </div>
                <div id="namePromptModal" class="modal" style="display: none;">
    <div class="modal-content">
        <h2>Harika Skor!</h2>
        <h4 style="font-weight: normal; margin-top: -10px;">Puanını kaydetmek için bir isim belirle:</h4>
        <input type="text" id="playerNameInput" placeholder="Adını Buraya Gir..." maxlength="15" style="width: 100%; margin-bottom: 15px; padding: 12px; font-size: 1em; box-sizing: border-box;">
        <button class="game-button" id="saveScoreBtn" data-translate-key="saveScore" style="width: 100%; margin: 0;">Puanı Kaydet</button>
    </div>
</div>
                <button class="game-button" id="backToMenuBtn" data-translate-key="backToMenu">Ana Menü</button>
            </div>
        </div>

        <div id="scoreboardPage" style="display: none;">
    <h2 data-translate-key="leaderboardTitle">🏆 Yüksek Puanlar 🏆</h2>

    <div class="leaderboard-tabs">
        <button class="tab-btn active" data-period="daily" data-translate-key="daily">Günlük</button>
        <button class="tab-btn" data-period="weekly" data-translate-key="weekly">Haftalık</button>
        <button class="tab-btn" data-period="monthly" data-translate-key="monthly">Aylık</button>
        <button class="tab-btn" data-period="alltime" data-translate-key="alltime">Tümü</button>
    </div>

    <ul id="highScoresList">
        </ul>
    
    <button class="game-button" id="backToMenuFromScores" data-translate-key="backToMenu" style="margin-top: 20px;">Ana Menü</button>
</div>

<div id="settingsPage" style="display: none;">
    <div id="settings-main-view" class="settings-view">
    <h2 data-translate-key="settingsTitle">⚙️ Ayarlar ⚙️</h2>
    <div class="settings-menu">
        
        <button class="game-button settings-menu-btn" data-target-view="settings-language-view"><i class="fas fa-language"></i> <span data-translate-key="languageSettings">Dil Ayarları</span></button>
        <button class="game-button settings-menu-btn" data-target-view="settings-sound-view"><i class="fas fa-volume-up"></i> <span data-translate-key="soundSettings">Ses Ayarları</span></button>
        
        <button class="game-button settings-menu-btn" data-modal-id="howToPlayModal"><i class="fas fa-question-circle"></i> <span data-translate-key="howToPlay">Nasıl Oynanır?</span></button>
        <button class="game-button settings-menu-btn" data-modal-id="creditsModal"><i class="fas fa-info-circle"></i> <span data-translate-key="credits">Künye</span></button>
        <button class="game-button settings-menu-btn" data-modal-id="privacyModal"><i class="fas fa-user-secret"></i> <span data-translate-key="privacyPolicy">Gizlilik Politikası</span></button>
    
        <button class="game-button" id="backToMenuFromSettings" data-translate-key="backToMenu" style="margin-top: 30px;">Ana Menü</button>

    </div>
</div>
    <div id="settings-language-view" class="settings-view" style="display: none;">
        <div class="settings-view-header">
            <button class="settings-back-btn" aria-label="Geri Dön"><i class="fas fa-arrow-left"></i></button>
            
            <h3 data-translate-key="languageSettings">Dil Ayarları</h3>
            
        </div>
        <div class="language-selection-container">
            
            <label class="lang-option-label">
                <input type="radio" name="language_select" value="tr" checked>
                <span class="lang-option-content">
                    <img class="lang-flag-img" src="https://flagcdn.com/w40/tr.png" alt="Türkçe Bayrağı">
                    <span class="lang-name">Türkçe</span>
                </span>
            </label>
            <label class="lang-option-label">
                <input type="radio" name="language_select" value="en">
                <span class="lang-option-content">
                    <img class="lang-flag-img" src="https://flagcdn.com/w40/gb.png" alt="İngiltere Bayrağı">
                    <span class="lang-name">English</span>
                </span>
            </label>
            
             <label class="lang-option-label">
                <input type="radio" name="language_select" value="de">
                <span class="lang-option-content">
                    <img class="lang-flag-img" src="https://flagcdn.com/w40/de.png" alt="Almanya Bayrağı">
                    <span class="lang-name">Deutsch</span>
                </span>
            </label>
            <label class="lang-option-label">
                <input type="radio" name="language_select" value="ko">
                <span class="lang-option-content">
                    <img class="lang-flag-img" src="https://flagcdn.com/w40/kr.png" alt="Kore Bayrağı">
                    <span class="lang-name">한국어</span>
                </span>
            </label>
            <label class="lang-option-label">
                <input type="radio" name="language_select" value="zh">
                <span class="lang-option-content">
                    <img class="lang-flag-img" src="https://flagcdn.com/w40/cn.png" alt="Çin Bayrağı">
                    <span class="lang-name">中文</span>
                </span>
            </label>
            <label class="lang-option-label">
                <input type="radio" name="language_select" value="fr">
                <span class="lang-option-content">
                    <img class="lang-flag-img" src="https://flagcdn.com/w40/fr.png" alt="Fransa Bayrağı">
                    <span class="lang-name">Français</span>
                </span>
            </label>
            <label class="lang-option-label">
                <input type="radio" name="language_select" value="ru">
                <span class="lang-option-content">
                    <img class="lang-flag-img" src="https://flagcdn.com/w40/ru.png" alt="Rusya Bayrağı">
                    <span class="lang-name">Русский</span>
                </span>
            </label>
            <label class="lang-option-label">
                <input type="radio" name="language_select" value="ja">
                <span class="lang-option-content">
                    <img class="lang-flag-img" src="https://flagcdn.com/w40/jp.png" alt="Japonya Bayrağı">
                    <span class="lang-name">日本語</span>
                </span>
            </label>
            <label class="lang-option-label">
                <input type="radio" name="language_select" value="sv">
                <span class="lang-option-content">
                    <img class="lang-flag-img" src="https://flagcdn.com/w40/se.png" alt="İsveç Bayrağı">
                    <span class="lang-name">Svenska</span>
                </span>
            </label>
            <label class="lang-option-label">
                <input type="radio" name="language_select" value="it">
                <span class="lang-option-content">
                    <img class="lang-flag-img" src="https://flagcdn.com/w40/it.png" alt="İtalya Bayrağı">
                    <span class="lang-name">Italiano</span>
                </span>
            </label>
            <label class="lang-option-label">
                <input type="radio" name="language_select" value="no">
                <span class="lang-option-content">
                    <img class="lang-flag-img" src="https://flagcdn.com/w40/no.png" alt="Norveç Bayrağı">
                    <span class="lang-name">Norsk</span>
                </span>
            </label>
            <label class="lang-option-label">
                <input type="radio" name="language_select" value="ro">
                <span class="lang-option-content">
                    <img class="lang-flag-img" src="https://flagcdn.com/w40/ro.png" alt="Romanya Bayrağı">
                    <span class="lang-name">Română</span>
                </span>
            </label>
            <label class="lang-option-label">
                <input type="radio" name="language_select" value="pl">
                <span class="lang-option-content">
                    <img class="lang-flag-img" src="https://flagcdn.com/w40/pl.png" alt="Polonya Bayrağı">
                    <span class="lang-name">Polski</span>
                </span>
            </label>
        </div>
        
        <button class="game-button" id="saveSettingsBtnLang" data-translate-key="saveSettings" style="margin-top: 25px; width: 100%;">Ayarları Kaydet</button>
    </div>

    
    <div id="settings-sound-view" class="settings-view" style="display: none;">
        <div class="settings-view-header">
             <button class="settings-back-btn" aria-label="Geri Dön"><i class="fas fa-arrow-left"></i></button>
             <h3 data-translate-key="soundSettings">Ses Ayarları</h3>
             
        </div>
        <div style="padding-top: 20px;">
            <div>
                <label for="musicVolume" data-translate-key="backgroundMusic">Arka Plan Müziği: <span id="musicVolumeValue" class="volume-value">50</span></label>
                <input type="range" id="musicVolume" min="0" max="100" value="50">
                <label for="musicMute" style="display:inline; font-weight:normal; margin-left: 10px;" data-translate-key="mute">Sessiz</label>
                <input type="checkbox" id="musicMute">
            </div>
            <div>
                <label for="sfxVolume" data-translate-key="soundEffects">Ses Efektleri: <span id="sfxVolumeValue" class="volume-value">70</span></label>
                <input type="range" id="sfxVolume" min="0" max="100" value="70">
                <label for="sfxMute" style="display:inline; font-weight:normal; margin-left: 10px;" data-translate-key="mute">Sessiz</label>
                <input type="checkbox" id="sfxMute">
            </div>
        </div>
        
        <button class="game-button" id="saveSettingsBtnSound" data-translate-key="saveSettings" style="margin-top: 25px; width:100%;">Ayarları Kaydet</button>
    </div>
    
</div>

        <div id="achievementsModal" class="modal">
            <div class="modal-content">
                <span class="close-btn" data-modal-id="achievementsModal">&times;</span>
                <h2>🏆 Başarımlar 🏆</h2>
                <ul id="achievementsList"></ul>
            </div>
        </div>
    </div>
    <div id="achievementUnlockedPopup">Başarı Kazanıldı!</div>
    
    <div id="rewardDisplayPopup">
        <div id="rewardDisplayIcon"></div>
        <div id="rewardDisplayTitle"></div>
        <div id="rewardDisplayAmount"></div>
    </div>

    <div id="dailyRewardModal" class="modal">
    <div class="modal-content daily-reward-container">
        <span class="close-btn">&times;</span>
        <h2 data-translate-key="dailyRewardsTitle">🎁 Günlük Ödüller 🎁</h2>
        <p class="daily-reward-subtitle" data-translate-key="dailyRewardsSubtitle">Büyük ödül için her gün giriş yap!</p>
        <div id="dailyRewardGrid" class="daily-reward-grid"></div>
        <button id="claimDailyRewardBtn" class="game-button" disabled data-translate-key="claimReward">Ödülü Al</button>
    </div>
</div>

<div id="howToPlayModal" class="modal">
    <div class="modal-content">
        <h2 data-modal-title="howToPlayTitle"></h2>
        <div data-modal-content="howToPlayContentHTML" style="text-align: left; max-height: 60vh; overflow-y: auto; padding-right: 15px;">
            <!-- İçerik buraya JS ile yüklenecek -->
        </div>
        <button class="game-button modal-back-to-settings-btn" data-translate-key="backToSettings" style="margin-top: 20px;">Ayarlara Dön</button>
    </div>
</div>


<div id="creditsModal" class="modal">
    <div class="modal-content">
        <h2 data-modal-title="creditsTitle"></h2>
        <div data-modal-content="creditsContentHTML" style="text-align: center; max-height: 60vh; overflow-y: auto; padding: 0 15px;">
            <!-- İçerik buraya JS ile yüklenecek -->
        </div>
        <button class="game-button modal-back-to-settings-btn" data-translate-key="backToSettings" style="margin-top: 20px;">Ayarlara Dön</button>
    </div>
</div>


<div id="privacyModal" class="modal">
    <div class="modal-content">
         <h2 data-modal-title="privacyTitle"></h2>
         <div data-modal-content="privacyContentHTML" style="text-align: center; padding: 10px 15px; font-size: 0.95em;">
            <!-- İçerik buraya JS ile yüklenecek -->
         </div>
         <button class="game-button modal-back-to-settings-btn" data-translate-key="backToSettings" style="margin-top: 20px;">Ayarlara Dön</button>
    </div>
</div>
</body>
    <div id="notificationPopup"></div>

    <div id="shopPage" style="display: none;">
    <h2 data-translate-key="shopTitle">Mağaza</h2>
    <div class="shop-resource-bar">
        <div class="resource-item">
            <span class="resource-icon">❤️</span>
            <span id="shopLivesDisplay"></span>
        </div>
        <div class="resource-item">
            <span class="resource-icon">💰</span>
            <span id="shopGoldDisplay"></span>
        </div>
    </div>

    <div class="shop-section">
        <div class="shop-section-header header-watch-earn"><h4 data-translate-key="watchAndEarn">İzle Kazan</h4></div>
        <div class="watch-and-earn-grid">
            <div class="watch-ad-card">
                <span class="watch-ad-icon">💰</span>
                <span class="watch-ad-title" data-translate-key="earnGold">Altın Kazan</span>
                <span class="watch-ad-desc" data-translate-key="earnGoldDesc">+50 Altın</span>
                <button id="watchAdForGoldBtn" class="game-button small-btn watch-ad-btn" data-translate-key="watchBtn">İZLE</button>
            </div>
            <div class="watch-ad-card">
                <span class="watch-ad-icon">❤️</span>
                <span class="watch-ad-title" data-translate-key="earnLife">Can Kazan</span>
                <span class="watch-ad-desc" data-translate-key="earnLifeDesc">+1 Can</span>
                <button id="watchAdForLifeBtn" class="game-button small-btn watch-ad-btn" data-translate-key="watchBtn">İZLE</button>
            </div>
        </div>
    </div>

    <div class="shop-section">
        <div class="shop-section-header header-jokers"><h4 data-translate-key="jokers">Jokerler</h4></div>
        <div class="shop-item-grid">
            <div class="shop-item-card">
                <span class="shop-item-icon">🌓</span>
                <span class="shop-item-name" data-translate-key="joker5050_shop">50/50 Jokeri</span>
                <button class="game-button small-btn buy-btn" data-item="joker" data-type="fiftyFifty">80 💰</button>
            </div>
            <div class="shop-item-card">
                <span class="shop-item-icon">⏳</span>
                <span class="shop-item-name" data-translate-key="jokerTime_shop">Süre Jokeri</span>
                <button class="game-button small-btn buy-btn" data-item="joker" data-type="time">60 💰</button>
            </div>
            <div class="shop-item-card">
                <span class="shop-item-icon">⏩</span>
                <span class="shop-item-name" data-translate-key="jokerSkip_shop">Pas Jokeri</span>
                <button class="game-button small-btn buy-btn" data-item="joker" data-type="skip">110 💰</button>
            </div>
            <div class="shop-item-card">
                <span class="shop-item-icon">💡</span>
                <span class="shop-item-name" data-translate-key="jokerHint_shop">İpucu Jokeri</span>
                <button class="game-button small-btn buy-btn" data-item="joker" data-type="hint">55 💰</button>
            </div>
        </div>
    </div>

    <div class="shop-section">
        <div class="shop-section-header header-lives"><h4 data-translate-key="lives">Can</h4></div>
        <div class="shop-item-grid">
            <div class="shop-item-card">
                <span class="shop-item-icon">❤️</span>
                <span class="shop-item-name" data-translate-key="life_single_shop">1 Can</span>
                <button class="game-button small-btn buy-btn" data-item="life" data-type="single">100 💰</button>
            </div>
            <div class="shop-item-card">
                <span class="shop-item-icon">❤️❤️❤️</span>
                <span class="shop-item-name" data-translate-key="life_full_shop">5 Can (Tam Doldur)</span>
                <button class="game-button small-btn buy-btn" data-item="life" data-type="full">400 💰</button>
            </div>
            <div class="shop-item-card unlimited">
                <span class="shop-item-icon">❤️<sub>∞</sub></span>
                <span class="shop-item-name" data-translate-key="life_unlimited_1h">Sınırsız Can (1 Saat)</span>
                <button class="game-button small-btn buy-btn" data-item="unlimited_life" data-duration="1">2000 💰</button>
            </div>
            <div class="shop-item-card unlimited popular">
                <div class="popular-tag" data-translate-key="popular">EN POPÜLER</div>
                <span class="shop-item-icon">❤️<sub>∞</sub></span>
                <span class="shop-item-name" data-translate-key="life_unlimited_24h">Sınırsız Can (24 Saat)</span>
                <button class="game-button small-btn buy-btn" data-item="unlimited_life" data-duration="24">5000 💰</button>
            </div>
        </div>
    </div>

    <button class="game-button" id="backToMenuFromShop" data-translate-key="backToMenu" style="margin-top: 20px;">Ana Menü</button>
</div>
    
    <div id="profilePage" style="display: none;">
    <div class="profile-banner">
    </div>
    <div id="profilePicContainer" class="profile-pic-wrapper">
        <img id="profilePic" src="avatars/avatar1.png" alt="Profil Resmi">
        <div class="profile-pic-edit-overlay">✏️</div>
    </div>
    <div class="profile-user-info">
        <input type="text" id="usernameInput" value="Oyuncu">
        <span id="userIDDisplay">#ABCDE12345</span>
    </div>

    <div id="avatarSelection" style="display: none; margin-bottom: 20px; padding-top: 10px;">
        <h4 data-translate-key="selectAvatar">Avatar Seç</h4>
        <div class="avatar-grid">
            <img class="avatar-option" src="avatars/avatar1.png" data-avatar="avatars/avatar1.png">
            <img class="avatar-option" src="avatars/avatar2.png" data-avatar="avatars/avatar2.png">
            <img class="avatar-option" src="avatars/avatar3.png" data-avatar="avatars/avatar3.png">
            <img class="avatar-option" src="avatars/avatar4.png" data-avatar="avatars/avatar4.png">
            <img class="avatar-option" src="avatars/avatar5.png" data-avatar="avatars/avatar5.png">
        </div>
    </div>

<div class="profile-tabs">
        <button class="tab-btn active" data-tab="achievements" data-translate-key="achievements">Başarımlar</button>
        <button class="tab-btn" data-tab="stats" data-translate-key="statistics">İstatistikler</button>
    </div>

    <div class="profile-content-wrapper">
        <div id="profile-achievements-content" class="tab-content active">
            <div class="xp-level-area">
                <div class="level-display">
                    <span class="level-icon">🏆</span>
                    <span id="playerLevelDisplay">Sv. 1</span>
                </div>
                <div class="xp-bar-container">
                    <div class="xp-bar-fill" id="xpBarFill" style="width: 0%;"></div>
                </div>
                <div class="xp-text" id="xpTextDisplay">0 / 100 XP</div>
            </div>
            <ul id="profileAchievementsList">
            </ul>
        </div>
        <div id="profile-stats-content" class="tab-content">
            <div style="padding: 20px; text-align: center;">
                <h4 data-translate-key="rateUsTitle">Oyunumuzu Sevdiniz mi?</h4>
                <p data-translate-key="rateUsDesc">Desteğiniz bizim için çok değerli. Mağazada bize puan vererek daha fazla kişiye ulaşmamıza yardımcı olabilirsiniz!</p>
                <button id="rateGameBtn" class="game-button">⭐ <span data-translate-key="rateGameBtn">Oyuna Puan Ver</span> ⭐</button>
                
                <hr style="margin: 25px 0; border-color: #e0e0e0; border-style: dashed;">

                <h4 data-translate-key="contributeTitle">Gelişime Katkıda Bulun</h4>
                <p data-translate-key="contributeDesc">Oyuna eklenmesini istediğiniz soruları bize göndererek Bilgi Ağacı'nın büyümesine yardımcı olabilirsiniz!</p>
                <button id="submitQuestionBtn" class="game-button">📝 <span data-translate-key="submitQuestionBtn">Soru Gönder</span></button>

                <hr style="margin: 25px 0; border-color: #e0e0e0; border-style: dashed;">

                <h4 data-translate-key="feedbackTitle">Öneri ve Sorun Bildir</h4>
                <p data-translate-key="feedbackDesc">Oyunla ilgili fikirlerinizi, önerilerinizi veya karşılaştığınız sorunları bize buradan bildirebilirsiniz.</p>
                <button id="feedbackBtn" class="game-button">📢 <span data-translate-key="feedbackBtn">Öneri ve Sorun Bildir</span></button>
            </div>
        </div>
    </div> 
    
    <button class="game-button" id="backToMenuFromProfile" data-translate-key="backToMenu" style="margin: 20px auto 10px; display: block;">Ana Menü</button>
</div>

<script src="sorular.js"></script>
<script src="language.js"></script>

<script>
/*
 * Bilgi Ağacı Oyunu - Ana Oyun Kodları
 * Copyright (c) 2025 BEYZZ GAMES
 * Tüm hakları saklıdır. Bu eserin izinsiz kopyalanması ve dağıtılması yasaktır.
 */


let questionTimerInterval = null;

const FORM_URLS = {
    submitQuestion: {
        'tr': 'https://forms.gle/DmEoHwwNZWBXp3ix9',
        'en': 'https://forms.gle/YaEPjkA88tT45ABw5',
        'de': 'https://forms.gle/Xc2C2PPhFEG16ZmG9',
        'ko': 'https://forms.gle/qzJXoNvvWvTNE3A27',
        'zh': 'https://forms.gle/dfdxMk3KFJecePHc6',
        'fr': 'https://forms.gle/1uorneAKes7CcXog7',
        'ru': 'https://forms.gle/Q2QFn9DT3NX9guVL7',
        'ja': 'https://forms.gle/MGfGsYypq5JtN4hx6',
        'sv': 'https://forms.gle/znQqC67JZ1t5fN997',
        'it': 'https://forms.gle/ikPJpMbpCTzWSzHq6',
        'no': 'https://forms.gle/pG1VjSpjriwq9SNd6',
        'ro': 'https://forms.gle/iYBNyfz7gA1wuMWT7',
        'pl': 'https://forms.gle/HWeXaesckvP9rA1e7',
    
    },
    feedback: {
        'tr': 'https://forms.gle/bk3BLxqj51s1oRt76',
        'en': 'https://forms.gle/KwHruQfodbbAsVba8',
        'de': 'https://forms.gle/bSu4bq1CmSiR7K3z7',
        'ko': 'https://forms.gle/KtadBeQtoiy8cumh6',
        'zh': 'https://forms.gle/VDhvzarjb8ZyPTNC9',
        'fr': 'https://forms.gle/pejw3PHxmaHYpUaC7',
        'ru': 'https://forms.gle/jAfJnAKAdeeUMXLb8',
        'ja': 'https://forms.gle/ZHeztA61y9Ty8MQo7',
        'sv': 'https://forms.gle/XbHF7ahQwZAgWa6z6',
        'it': 'https://forms.gle/1mKzzpZmfPBVps7p9',
        'no': 'https://forms.gle/PWjGNWCpq5nNu47w5',
        'ro': 'https://forms.gle/hnEWa1TaJshr4ShV6',
        'pl': 'https://forms.gle/jzSBWhhFqrFKxjdT7',

    },
};




    const startScreen = document.getElementById('startScreen');
    const questionPage = document.getElementById('questionPage');
    const categorySelectionScreen = document.getElementById('categorySelectionScreen');
    const backToMenuFromCatSelectionBtn = document.getElementById('backToMenuFromCatSelection');
    const backToMenuFromProfile = document.getElementById('backToMenuFromProfile');
    const startGameBtnClassic = document.getElementById('startGameBtnClassic');
    const startTimeAttackBtn = document.getElementById('startTimeAttackBtn');
    const startSurvivalBtn = document.getElementById('startSurvivalBtn');
    const startCategoryChallengeBtn = document.getElementById('startCategoryChallengeBtn');
    const scoreboardBtn = document.getElementById('scoreboardBtn');
    const settingsBtn = document.getElementById('settingsBtn');
    const backToMenuBtn = document.getElementById('backToMenuBtn');
    const nextQuestionBtn = document.getElementById('nextQuestionBtn');
    const questionPageContainer = document.getElementById('questionPageContainer');
    const categoryInfo = document.getElementById('categoryInfo');
    const scoreInfo = document.getElementById('scoreInfo');
    const streakInfo = document.getElementById('streakInfo');
    const questionText = document.getElementById('questionText');
    const answerOptionsContainer = document.getElementById('answerOptions');
    const timerDisplay = document.getElementById('timerDisplay');
    const masterTimerDisplay = document.getElementById('masterTimerDisplay');
    const hintArea = document.getElementById('hintArea');
    const explanationArea = document.getElementById('explanationArea');
    const joker5050Btn = document.getElementById('joker5050');
    const jokerTimeBtn = document.getElementById('jokerTime');
    const jokerSkipBtn = document.getElementById('jokerSkip');
    const jokerHintBtn = document.getElementById('jokerHint');
    const playerLevelDisplay = document.getElementById('playerLevelDisplay');
    const xpBarFill = document.getElementById('xpBarFill');
    const xpTextDisplay = document.getElementById('xpTextDisplay');
    const jokerButtons = {joker5050: joker5050Btn,jokerTime: jokerTimeBtn,jokerSkip: jokerSkipBtn,jokerHint: jokerHintBtn};
    const namePromptModal = document.getElementById('namePromptModal');
    const playerNameInput = document.getElementById('playerNameInput');
    const saveScoreBtn = document.getElementById('saveScoreBtn');
    const scoreboardModal = document.getElementById('scoreboardModal');
    const settingsModal = document.getElementById('settingsModal');
    const achievementsModal = document.getElementById('achievementsModal');
    const highScoresList = document.getElementById('highScoresList');
    const achievementsList = document.getElementById('achievementsList');
    const musicVolumeSlider = document.getElementById('musicVolume');
    const sfxVolumeSlider = document.getElementById('sfxVolume');
    const musicVolumeValue = document.getElementById('musicVolumeValue');
    const sfxVolumeValue = document.getElementById('sfxVolumeValue');
    const musicMuteCheckbox = document.getElementById('musicMute');
    const sfxMuteCheckbox = document.getElementById('sfxMute');
    const saveSettingsBtnModal = document.getElementById('saveSettingsBtnModal');
    const audioElements = {
        click: document.getElementById('clickSound'),
        correct: document.getElementById('correctSound'),
        wrong: document.getElementById('wrongSound'),
        timeUp: document.getElementById('timeUpSound'),
        achievement: document.getElementById('achievementSound')
    };
    const achievementUnlockedPopup = document.getElementById('achievementUnlockedPopup');
    const jokersArea = document.querySelector('.jokers-area');
    const difficultyButtons = document.querySelectorAll('.difficulty-btn');
    const notificationPopup = document.getElementById('notificationPopup');
    const resetHighScoresBtn = document.getElementById('resetHighScoresBtn');
    const resetAchievementsBtn = document.getElementById('resetAchievementsBtn');
    const resetPlayerDataBtn = document.getElementById('resetPlayerDataBtn');
    const playerLivesDisplay = document.getElementById('playerLives');
    const playerGoldDisplay = document.getElementById('playerGold');
    const JOKER_PRICES = {
        fiftyFifty: 80,
        time: 60,
        skip: 110,
        hint: 55
    };
    const LIFE_PRICES = {
        single: 100,
        full: 400
    };
    const profileBtn = document.getElementById('profileBtn');
    const profilePic = document.getElementById('profilePic');
    const profilePicContainer = document.getElementById('profilePicContainer');
    const usernameInput = document.getElementById('usernameInput');
    const userIDDisplay = document.getElementById('userIDDisplay');
    const avatarSelection = document.getElementById('avatarSelection');
    const avatarOptions = document.querySelectorAll('.avatar-option');
    const profileAchievementsList = document.getElementById('profileAchievementsList');
    const backToMenuFromSettings = document.getElementById('backToMenuFromSettings');

    const categoryClassMap = {
        "Tarih": "bg-tarih",
        "Coğrafya": "bg-cografya",
        "Bilim ve Teknoloji": "bg-bilim-ve-teknoloji",
        "Sanat": "bg-sanat",
        "Edebiyat": "bg-edebiyat",
        "Spor": "bg-spor",
        "Matematik": "bg-matematik",
        "Felsefe": "bg-felsefe",
        "Mitoloji": "bg-mitoloji",
        "Sinema ve Televizyon": "bg-sinema",
        "Müzik": "bg-muzik",
        "Doğa ve Çevre": "bg-doga",
        "Genel Kültür": "bg-genel-kultur",
        "Güncel Olaylar": "bg-guncel"
    };

    const questionScreenBgMap = {
        "Tarih": "qs-bg-tarih",
        "Coğrafya": "qs-bg-cografya",
        "Bilim ve Teknoloji": "qs-bg-bilim-ve-teknoloji",
        "Sanat": "qs-bg-sanat",
        "Edebiyat": "qs-bg-edebiyat",
        "Spor": "qs-bg-spor",
        "Matematik": "qs-bg-matematik",
        "Felsefe": "qs-bg-felsefe",
        "Mitoloji": "qs-bg-mitoloji",
        "Sinema ve Televizyon": "qs-bg-sinema",
        "Müzik": "qs-bg-muzik",
        "Doğa ve Çevre": "qs-bg-doga",
        "Genel Kültür": "qs-bg-genel-kultur",
        "Güncel Olaylar": "qs-bg-guncel"
    };

    const ACHIEVEMENT_DEFS = {
        "bilimTomurcugu": {
            name: "Bilim Tomurcuğu",
            desc: "10 'Bilim ve Teknoloji' sorusunu doğru cevapla",
            icon: "🔬",
            unlocked: false,
            dateUnlocked: null,
            progress: 0,
            target: 10,
            category: "Bilim ve Teknoloji"
        },
        "stratejist": {
            name: "Stratejist",
            desc: "Bir oyunda tüm joker türlerini kullan",
            icon: "♟️",
            unlocked: false,
            dateUnlocked: null
        },
        "bilgelikSerisi": {
            name: "Bilgelik Serisi",
            desc: "Art arda 5 soruya doğru cevap ver",
            icon: "🌟",
            unlocked: false,
            dateUnlocked: null
        },
        "oyunAcemisi": {
            name: "Oyun Acemisi",
            desc: "İlk oyununu tamamla (herhangi bir mod)",
            icon: "🔰",
            unlocked: false,
            dateUnlocked: null,
            target: 1
        },
        "merakliZihin": {
            name: "Meraklı Zihin",
            desc: "Toplam 50 soruyu doğru cevapla",
            icon: "🧠",
            unlocked: false,
            dateUnlocked: null,
            target: 50
        },
        "kategoriKasifi": {
            name: "Kategori Kaşifi",
            desc: "3 farklı kategoride en az 3'er soru bil",
            icon: "🗺️",
            unlocked: false,
            dateUnlocked: null,
            categoriesMastered: {},
            targetCategories: 3,
            targetCorrectPerCategory: 3
        },
        "klasikUzmani": {
            name: "Klasik Uzmanı",
            desc: "Klasik Mod'da 200+ puan al",
            icon: "🏆",
            unlocked: false,
            dateUnlocked: null,
            targetScore: 200,
            mode: "classic"
        },
        "hizTutkunu": {
            name: "Hız Tutkunu",
            desc: "Zamana Karşı Mod'da 15+ doğru yap",
            icon: "💨",
            unlocked: false,
            dateUnlocked: null,
            targetScore: 15,
            mode: "timeAttack"
        },
        "hayattaKalan": {
            name: "Hayatta Kalan",
            desc: "Hayatta Kalma Mod'da 10+ soru bil (Puan olarak)",
            icon: "🛡️",
            unlocked: false,
            dateUnlocked: null,
            targetScore: 10,
            mode: "survival"
        },
        "uzunSeri": {
            name: "Uzun Soluklu Seri",
            desc: "Art arda 10 soruya doğru cevap ver",
            icon: "✨",
            unlocked: false,
            dateUnlocked: null,
            targetStreak: 10
        },
        "jokerSever": {
            name: "Joker Sever",
            desc: "Toplam 20 joker kullan (herhangi bir tür)",
            icon: "🃏",
            unlocked: false,
            dateUnlocked: null,
            target: 20
        },
        "puanAvcisi": {
            name: "Puan Avcısı",
            desc: "Tek bir Klasik oyunda 300+ puan yap",
            icon: "🎯",
            unlocked: false,
            dateUnlocked: null,
            targetScore: 300,
            mode: "classic"
        },
        "bilgiKurdu": {
            name: "Bilgi Kurdu",
            desc: "Toplam 250 soruyu doğru cevapla",
            icon: "📚",
            unlocked: false,
            dateUnlocked: null,
            target: 250
        },
        "kategoriUstasi": {
            name: "Kategori Ustası",
            desc: "Bir Kategori Uzmanı modunu %80+ başarıyla tamamla (min 10 soru)",
            icon: "🎓",
            unlocked: false,
            dateUnlocked: null,
            mode: "categoryChallenge",
            targetPercentage: 80,
            minQuestions: 10
        },
        "zamanEfendisi": {
            name: "Zaman Efendisi",
            desc: "Zamana Karşı Mod'da 25+ doğru yap",
            icon: "⌛",
            unlocked: false,
            dateUnlocked: null,
            targetScore: 25,
            mode: "timeAttack"
        },
        "yenilmezRuh": {
            name: "Yenilmez Ruh",
            desc: "Hayatta Kalma Mod'da 20+ soru bil (Puan olarak)",
            icon: "🎖️",
            unlocked: false,
            dateUnlocked: null,
            targetScore: 20,
            mode: "survival"
        },
        "mukemmeliyetciOyuncu": {
            name: "Mükemmeliyetçi",
            desc: "Bir Klasik oyunu (min 10 soru) hatasız tamamla",
            icon: "💯",
            unlocked: false,
            dateUnlocked: null,
            mode: "classic",
            minQuestions: 10
        },
        "jokersizKahraman": {
            name: "Jokersiz Kahraman",
            desc: "Bir Klasik oyunu (min 10 soru, 150+ puan) hiç joker kullanmadan tamamla",
            icon: "🦸",
            unlocked: false,
            dateUnlocked: null,
            mode: "classic",
            minQuestions: 10,
            minScore: 150
        },
        "tarihciRuhu": {
            name: "Tarihçi Ruhu",
            desc: "20 Tarih sorusunu doğru bil",
            icon: "📜",
            unlocked: false,
            dateUnlocked: null,
            progress: 0,
            target: 20,
            category: "Tarih"
        },
        "cografyaMeraki": {
            name: "Coğrafya Merakı",
            desc: "20 Coğrafya sorusunu doğru bil",
            icon: "🌍",
            unlocked: false,
            dateUnlocked: null,
            progress: 0,
            target: 20,
            category: "Coğrafya"
        },
        "sanatElestirmeni": {
            name: "Sanat Eleştirmeni",
            desc: "15 Sanat sorusunu doğru bil",
            icon: "🎨",
            unlocked: false,
            dateUnlocked: null,
            progress: 0,
            target: 15,
            category: "Sanat"
        },
        "edebiyatAsigi": {
            name: "Edebiyat Aşığı",
            desc: "15 Edebiyat sorusunu doğru bil",
            icon: "✒️",
            unlocked: false,
            dateUnlocked: null,
            progress: 0,
            target: 15,
            category: "Edebiyat"
        },
        "sporTutkunu": {
            name: "Spor Tutkunu",
            desc: "15 Spor sorusunu doğru bil",
            icon: "⚽",
            unlocked: false,
            dateUnlocked: null,
            progress: 0,
            target: 15,
            category: "Spor"
        },
        "matematikCanavari": {
            name: "Matematik Canavarı",
            desc: "10 Matematik sorusunu doğru bil",
            icon: "➗",
            unlocked: false,
            dateUnlocked: null,
            progress: 0,
            target: 10,
            category: "Matematik"
        },
        "filozofTohumu": {
            name: "Filozof Tohumu",
            desc: "10 Felsefe sorusunu doğru bil",
            icon: "🤔",
            unlocked: false,
            dateUnlocked: null,
            progress: 0,
            target: 10,
            category: "Felsefe"
        },
        "mitolojiAvcisi": {
            name: "Mitoloji Avcısı",
            desc: "10 Mitoloji sorusunu doğru bil",
            icon: "🏛️",
            unlocked: false,
            dateUnlocked: null,
            progress: 0,
            target: 10,
            category: "Mitoloji"
        },
        "bilge": {
            name: "Bilge",
            desc: "Toplamda 500 soruyu doğru cevapla.",
            icon: "🦉",
            unlocked: false,
            dateUnlocked: null,
            target: 500
        },
        "ansiklopedi": {
            name: "Ansiklopedi",
            desc: "Toplamda 1000 soruyu doğru cevapla.",
            icon: "🌍",
            unlocked: false,
            dateUnlocked: null,
            target: 1000
        },
        "ilkAlisveris": {
            name: "İlk Alışveriş",
            desc: "Mağazadan herhangi bir ürünü ilk kez satın al.",
            icon: "🛒",
            unlocked: false,
            dateUnlocked: null
        },
        "isAdami": {
            name: "İş Adamı",
            desc: "Mağazada toplam 10,000 Altın harca.",
            icon: "💼",
            unlocked: false,
            dateUnlocked: null,
            progress: 0,
            target: 10000
        },
        "adanmisOyuncu": {
            name: "Adanmış Oyuncu",
            desc: "7 günlük ödül serisini tamamla ve büyük ödülü al.",
            icon: "🗓️",
            unlocked: false,
            dateUnlocked: null
        },
        "maceraciRuh": {
            name: "Maceracı Ruh",
            desc: "Oyunu Kolay, Orta ve Zor zorluk seviyelerinde en az birer kez bitir.",
            icon: "🧭",
            unlocked: false,
            dateUnlocked: null,
            difficultiesPlayed: { easy: false, medium: false, hard: false }
        },
        "katkidaBulunan": {
            name: "Katkıda Bulunan",
            desc: "'Soru Gönder' özelliğini kullanarak oyunun gelişimine destek ol.",
            icon: "✍️",
            unlocked: false,
            dateUnlocked: null
        },
        "zorluZeka": {
            name: "Zorlu Zeka",
            desc: "Zor seviyede bir Klasik oyunu 250+ puanla bitir.",
            icon: "🧠",
            unlocked: false,
            dateUnlocked: null,
            targetScore: 250,
            mode: "classic",
            difficulty: "hard"
        },
        "hizliVeMerakli": {
            name: "Hızlı ve Meraklı",
            desc: "Bir soruyu 3 saniyeden az sürede doğru cevapla",
            icon: "⚡",
            unlocked: false,
            dateUnlocked: null
        },
        "sonSaniyeci": {
            name: "Son Saniyeci",
            desc: "Bir soruyu son 1 saniyede doğru cevapla",
            icon: "⏱️",
            unlocked: false,
            dateUnlocked: null
        },
        "modGezgini": {
            name: "Mod Gezgini",
            desc: "Tüm oyun modlarını (Klasik, Zamana Karşı, Hayatta Kalma, Kategori Uzmanı) en az bir kere oyna.",
            icon: "🧭",
            unlocked: false,
            dateUnlocked: null,
            modesPlayed: {
                classic: false,
                timeAttack: false,
                survival: false,
                categoryChallenge: false
            }
        }
    };

    let lastPlayedMode = 'classic'; 
    let swiperCurrentIndex = 0;
    let currentQuestionIndex, score, jokerCounts, questionsShuffled = [],
        timeLeft;
    const TIME_JOKER_BONUS = 10;
    let answerSelected = false;
    let currentGameMode = 'classic';
    let selectedCategory = '';
    const TIME_ATTACK_TOTAL_DURATION = 120;
    let timeAttackMasterInterval, timeAttackTimeLeft;
    let achievements = {};
    let correctlyAnsweredThisGame = 0;
    let totalQuestionsThisSession = 0;
    const difficultySettings = {
    easy: {
        time: 25,
        baseScore: 1, 
        streakMultiplierCap: 3,
        name: "Kolay"
    },
    medium: {
        time: 20,
        baseScore: 2, 
        streakMultiplierCap: 4,
        name: "Orta"
    },
    hard: {
        time: 15,
        baseScore: 3, 
        streakMultiplierCap: 5,
        name: "Zor"
    }
};
    let selectedDifficulty = 'medium';
    let jokersUsedThisGame = {};
    let correctStreak = 0;
    let settings = {
        musicVolume: 0.4,
        sfxVolume: 0.8,
        musicMuted: false,
        sfxMuted: false,
        language: 'tr'
    };
    let currentLanguage = 'tr';
    let gamesPlayedStats = {
        classic: 0,
        timeAttack: 0,
        survival: 0,
        categoryChallenge: 0
    };
    let totalCorrectAnswersOverall = 0;
    let totalJokersUsedOverall = {
        fiftyfifty: 0,
        time: 0,
        skip: 0,
        hint: 0
    };
    let wrongAnswersCount;
    let jokersUsedThisQuestion = {};
    

    
    const LIFE_REGEN_INTERVAL_MS = 600000;
    const MAX_LIVES = 5;
    let playerData = {
        gold: 150,
        lives: 5,
        xp: 0, 
        level: 1,  
        lastLifeRegenTimestamp: Date.now(),
        unlimitedLivesUntil: null,
        lastFreeJokerClaimed: null,
        consecutiveLoginDays: 0, 
        lastLoginDate: null,
        totalGoldSpent: 0,
        difficultiesCompleted: {
            easy: false,
            medium: false,
            hard: false
        },
        jokers: {
            fiftyFifty: 2,
            time: 2,
            skip: 1,
            hint: 2
        },
        avatar: 'avatars/avatar1.png',
        userId: null
    };


    const DAILY_REWARDS = [
        { day: 1, type: 'gold', amount: 50, icon: '💰' },
        { day: 2, type: 'gold', amount: 100, icon: '💰' },
        { day: 3, type: 'joker', jokerType: 'fiftyFifty', amount: 1, icon: '🌓' },
        { day: 4, type: 'gold', amount: 200, icon: '💰' },
        { day: 5, type: 'joker', jokerType: 'skip', amount: 1, icon: '⏩' },
        { day: 6, type: 'gold', amount: 300, icon: '💰' },
        { day: 7, type: 'bundle', rewards: [
            { type: 'unlimited_life', duration: 1 },
            { type: 'gold', amount: 500 }
        ], icon: '🏆', text: 'Süper Ödül!' }
    ];

    function getLocalDateAsString(date) {
        const year = date.getFullYear();
        const month = (date.getMonth() + 1).toString().padStart(2, '0');
        const day = date.getDate().toString().padStart(2, '0');
        return `${year}-${month}-${day}`;
    }
    
    function isSameDay(date1, date2) {
        if (!date1 || !date2) return false;
        const d1 = new Date(date1);
        const d2 = new Date(date2);
        return d1.getFullYear() === d2.getFullYear() &&
               d1.getMonth() === d2.getMonth() &&
               d1.getDate() === d2.getDate();
    }
    

    function populateDailyRewardModal() {
        const grid = document.getElementById('dailyRewardGrid');
        const claimBtn = document.getElementById('claimDailyRewardBtn');
        if (!grid || !claimBtn) return;
        
        grid.innerHTML = '';
        const currentDay = playerData.consecutiveLoginDays;

        DAILY_REWARDS.forEach(reward => {
            const card = document.createElement('div');
            card.className = 'reward-card';

            let rewardText = '';
            if (reward.type === 'gold') {
                rewardText = `${reward.amount} Altın`;
            } else if (reward.type === 'joker') {
                rewardText = `+1 ${reward.icon} Joker`;
            } else if (reward.type === 'bundle') {
                rewardText = reward.text;
            }

            card.innerHTML = `
                <span class="day-label">Gün ${reward.day}</span>
                <span class="reward-icon">${reward.icon}</span>
                <span class="reward-text">${rewardText}</span>
            `;

            if (reward.day < currentDay) {
                card.classList.add('claimed');
            } else if (reward.day === currentDay) {
                card.classList.add('active');
            }
            
            if (reward.day === 7) {
                 card.classList.add('final-day');
            }

            grid.appendChild(card);
        });

        claimBtn.disabled = false;
    }

   function checkDailyReward() {
        const today = new Date();
        const todayStr = getLocalDateAsString(today);
        const lastLoginStr = playerData.lastLoginDate;

        if (todayStr === lastLoginStr) {
            return;
        }

        const yesterday = new Date();
        yesterday.setDate(today.getDate() - 1);
        const yesterdayStr = getLocalDateAsString(yesterday);

        if (lastLoginStr && lastLoginStr === yesterdayStr) {
            playerData.consecutiveLoginDays++;
        } else {
            playerData.consecutiveLoginDays = 1;
        }

        if (playerData.consecutiveLoginDays > DAILY_REWARDS.length) {
            playerData.consecutiveLoginDays = 1;
        }
        
        savePlayerData();
        
        populateDailyRewardModal();
        openModal(document.getElementById('dailyRewardModal'));
    }
     function showRewardPopup(icon, title, amountText) {
        const popup = document.getElementById('rewardDisplayPopup');
        if (!popup) return;

        document.getElementById('rewardDisplayIcon').textContent = icon;
        document.getElementById('rewardDisplayTitle').textContent = title;
        document.getElementById('rewardDisplayAmount').textContent = amountText;

        popup.classList.add('show');

        setTimeout(() => {
            popup.classList.remove('show');
        }, 3000);
    }
    function claimDailyReward() {
        const todayStr = getLocalDateAsString(new Date());
        if (playerData.lastLoginDate === todayStr) {
            showNotification('rewardAlreadyClaimed', 'info');
            return;
        }

        const currentDay = playerData.consecutiveLoginDays;
        const reward = DAILY_REWARDS.find(r => r.day === currentDay);
        if (!reward) return;

        playSound('achievement');

        let rewardIcon = reward.icon;
        let rewardTitle = '';
        let rewardAmountText = '';

        if (reward.type === 'gold') {
            playerData.gold += reward.amount;
            rewardTitle = 'Altın Kazandın!';
            rewardAmountText = `+${reward.amount}`;
        } else if (reward.type === 'joker') {
            playerData.jokers[reward.jokerType]++;
            rewardTitle = 'Joker Kazandın!';
            rewardAmountText = `+1 ${reward.icon} Jokeri`;
        } else if (reward.type === 'bundle') {
            unlockAchievement('adanmisOyuncu'); 
            reward.rewards.forEach(r => {
                if (r.type === 'gold') playerData.gold += r.amount;
                else if (r.type === 'unlimited_life') {
                    const now = Date.now();
                    const durationInMs = r.duration * 60 * 60 * 1000;
                    const baseTime = (playerData.unlimitedLivesUntil && playerData.unlimitedLivesUntil > now) 
                                   ? playerData.unlimitedLivesUntil : now;
                    playerData.unlimitedLivesUntil = baseTime + durationInMs;
                }
            });
            rewardTitle = 'Süper Ödül!';
            rewardAmountText = '+1 Saat Can & 500 Altın';
        }

        playerData.lastLoginDate = todayStr;
        savePlayerData();
        updatePlayerUIDisplay();
        
        showRewardPopup(rewardIcon, rewardTitle, rewardAmountText);

        closeModal(document.getElementById('dailyRewardModal'));
    }

function openExternalLink(url) {
    if (!url || typeof url !== 'string') {
        return;
    }
    playSound('click');
    window.open(url, '_blank');
}

const rateGameBtn = document.getElementById('rateGameBtn');
if (rateGameBtn) {
    safelySetClickListener(rateGameBtn, () => {
        const googlePlayUrl = 'https://play.google.com/store/apps/details?id=com.google.android.apps.maps';
        const appleAppStoreUrl = 'https://apps.apple.com/us/app/google-maps/id585027354';

        const userAgent = navigator.userAgent || navigator.vendor || window.opera;
        let storeUrl = googlePlayUrl;

        
        if (/iPad|iPhone|iPod/.test(userAgent) && !window.MSStream) {
            storeUrl = appleAppStoreUrl;
        }
        
        openExternalLink(storeUrl);
        showNotification('redirectToStore', 'info');
    });
}


const submitQuestionBtn = document.getElementById('submitQuestionBtn');
if (submitQuestionBtn) {
    safelySetClickListener(submitQuestionBtn, () => {
        unlockAchievement('katkidaBulunan');
        
        const url = FORM_URLS.submitQuestion[currentLanguage] || FORM_URLS.submitQuestion['tr'];
        openExternalLink(url);
    });
}


constfeedbackBtn = document.getElementById('feedbackBtn');
if (feedbackBtn) {
    safelySetClickListener(feedbackBtn, () => {
        
        const url = FORM_URLS.feedback[currentLanguage] || FORM_URLS.feedback['tr'];
        openExternalLink(url);
    });
}

function playSound(soundId, isMusic = false) {
    const audioElement = audioElements[soundId];
    if (!audioElement) return;

    if (isMusic) {
        try {
            audioElement.muted = settings.musicMuted;
            audioElement.volume = settings.musicVolume;
            if (audioElement.paused) {
                audioElement.play().catch(e => {});
            }
        } catch (e) {
        }
        return;
    }

    if (settings.sfxMuted) return;
    
    audioElement.volume = settings.sfxVolume;
    audioElement.currentTime = 0;
    audioElement.play().catch(e => {});

}

    function updateUIText() {
        currentLanguage = settings.language || 'tr';
        const translationData = translations[currentLanguage];
        if (!translationData) {
            return;
        }

        document.querySelectorAll('[data-translate-key]').forEach(element => {
            const key = element.getAttribute('data-translate-key');
            if (translationData[key]) {
                element.innerText = translationData[key];
            }
        });

        document.querySelectorAll('[data-translate-key-placeholder]').forEach(element => {
            const key = element.getAttribute('data-translate-key-placeholder');
            if (translationData[key]) {
                element.placeholder = translationData[key];
            }
        });
    }

    function stopMusic(soundId) {
        const audioElement = audioElements[soundId];
        if (audioElement) {
            audioElement.pause();
            audioElement.currentTime = 0;
        }
    }

    function showNotification(key, type = 'info', duration = 3000) {
        if (!notificationPopup) return;
        const message = translations[currentLanguage][key] || key;
        notificationPopup.textContent = message;
        notificationPopup.className = '';
        notificationPopup.classList.add('show', type);
        setTimeout(() => {
            notificationPopup.classList.remove('show', type);
        }, duration);
    }

    function loadAchievements() {
        const saved = JSON.parse(localStorage.getItem('bilgiAgaciAchievements_v3'));
        achievements = JSON.parse(JSON.stringify(ACHIEVEMENT_DEFS));
        if (saved) {
            for (const id in achievements) {
                if (saved[id]) {
                    achievements[id] = { ...achievements[id],
                        ...saved[id]
                    };
                }
            }
        }
        gamesPlayedStats = JSON.parse(localStorage.getItem('bilgiAgaciGameStats_v1')) || {
            classic: 0,
            timeAttack: 0,
            survival: 0,
            categoryChallenge: 0
        };
        totalCorrectAnswersOverall = parseInt(localStorage.getItem('bilgiAgaciTotalCorrect_v1')) || 0;
        totalJokersUsedOverall = JSON.parse(localStorage.getItem('bilgiAgaciTotalJokers_v1')) || {
            fiftyfifty: 0,
            time: 0,
            skip: 0,
            hint: 0
        };
    }

    function saveAchievementsAndStats() {
        localStorage.setItem('bilgiAgaciAchievements_v3', JSON.stringify(achievements));
        localStorage.setItem('bilgiAgaciGameStats_v1', JSON.stringify(gamesPlayedStats));
        localStorage.setItem('bilgiAgaciTotalCorrect_v1', totalCorrectAnswersOverall.toString());
        localStorage.setItem('bilgiAgaciTotalJokers_v1', JSON.stringify(totalJokersUsedOverall));
    }

    function showAchievementPopup(achievementId) {
    if (!achievementUnlockedPopup) return;

    const ach = achievements[achievementId];
    if (!ach) return;

    const lang = translations[currentLanguage];
    const unlockedText = lang.achievementUnlocked || 'Başarı Kazanıldı';
    const achievementName = lang[`achievements_${achievementId}_name`] || ach.name;

    achievementUnlockedPopup.innerHTML = `
        <div class="achievement-icon-large">${ach.icon || '🏆'}</div>
        <div class="achievement-title-main">${unlockedText}</div>
        <div class="achievement-name-specific">${achievementName}</div>
    `;

    achievementUnlockedPopup.classList.add('show');
    setTimeout(() => {
        achievementUnlockedPopup.classList.remove('show');
    }, 4000); 
}

    function unlockAchievement(id) {
        if (achievements[id] && !achievements[id].unlocked) {
            achievements[id].unlocked = true;
            achievements[id].dateUnlocked = new Date().toLocaleDateString("tr-TR");
            saveAchievementsAndStats();
            playSound('achievement');
           if (achievementUnlockedPopup) {
    showAchievementPopup(id);
}
            if (achievementsModal && achievementsModal.style.display === "flex") displayAchievements();
        }
    }

    function displayAchievements() {
    const listContainer = document.getElementById('profileAchievementsList');
    if (!listContainer || !achievements) return;

    const lang = translations[currentLanguage];
    listContainer.innerHTML = ''; 

    Object.keys(ACHIEVEMENT_DEFS).sort((a, b) => {
        const achA = achievements[a] || ACHIEVEMENT_DEFS[a];
        const achB = achievements[b] || ACHIEVEMENT_DEFS[b];
        if (achA.unlocked && !achB.unlocked) return -1;
        if (!achA.unlocked && achB.unlocked) return 1;
        const nameA = lang[`achievements_${a}_name`] || achA.name;
        const nameB = lang[`achievements_${b}_name`] || achB.name;
        return nameA.localeCompare(nameB, lang.locale || 'tr');
    }).forEach(id => {
        const achData = achievements[id] || ACHIEVEMENT_DEFS[id];
        if (!achData || !achData.name) return;

        const translatedName = lang[`achievements_${id}_name`] || achData.name;
        const translatedDesc = lang[`achievements_${id}_desc`] || achData.desc;

        const li = document.createElement('li');
        li.className = `achievement-item ${achData.unlocked ? 'unlocked' : 'locked'}`;

        let progress = 0;
        let currentValue = 0;
        let targetValue = achData.target || 0;

        if (achData.unlocked) {
            progress = 100;
        } else if (targetValue > 0) {
            if (achData.category && typeof achData.progress === 'number') {
                currentValue = achData.progress;
            } else if (id === "merakliZihin" || id === "bilgiKurdu") {
                currentValue = totalCorrectAnswersOverall;
            } else if (id === "jokerSever") {
                currentValue = Object.values(totalJokersUsedOverall).reduce((s, c) => s + c, 0);
            }
            if (targetValue > 0) {
                progress = Math.min(100, (currentValue / targetValue) * 100);
            }
        }
        
        li.innerHTML = `
            <div class="achievement-icon">${achData.icon || '❓'}</div>
            <div class="achievement-details">
                <span class="achievement-name">${translatedName}</span>
                <span class="achievement-desc">${translatedDesc}</span>
                ${targetValue > 0 || achData.unlocked ? `
                <div class="progress-bar-container">
                    <div class="progress-bar" style="--progress-percent: ${progress}%"></div>
                </div>
                ` : ''}
            </div>
        `;

        listContainer.appendChild(li);
    });
}

    function checkAllAchievements(questionCategoryIfCorrect = null, pointsEarnedThisTurn = 0, timeLeftWhenAnswered = -1) {
        if (!achievements) return;

    if (pointsEarnedThisTurn > 0) {
        if (achievements.bilge && !achievements.bilge.unlocked && totalCorrectAnswersOverall >= achievements.bilge.target) {
            unlockAchievement("bilge");
        }
        if (achievements.ansiklopedi && !achievements.ansiklopedi.unlocked && totalCorrectAnswersOverall >= achievements.ansiklopedi.target) {
            unlockAchievement("ansiklopedi");
        }
    }
        if (pointsEarnedThisTurn > 0) {
            if (achievements.merakliZihin && !achievements.merakliZihin.unlocked && totalCorrectAnswersOverall >= achievements.merakliZihin.target) unlockAchievement("merakliZihin");
            if (achievements.bilgiKurdu && !achievements.bilgiKurdu.unlocked && totalCorrectAnswersOverall >= achievements.bilgiKurdu.target) unlockAchievement("bilgiKurdu");
            if (achievements.bilgelikSerisi && !achievements.bilgelikSerisi.unlocked && correctStreak >= 5) unlockAchievement("bilgelikSerisi");
            if (achievements.uzunSeri && !achievements.uzunSeri.unlocked && correctStreak >= achievements.uzunSeri.targetStreak) unlockAchievement("uzunSeri");
            if (questionCategoryIfCorrect) {
                for (const achID in achievements) {
                    if (achievements[achID]?.category === questionCategoryIfCorrect && !achievements[achID].unlocked && typeof achievements[achID].progress === 'number') {
                        achievements[achID].progress = (achievements[achID].progress || 0) + 1;
                        if (achievements[achID].progress >= achievements[achID].target) unlockAchievement(achID);
                    }
                }
            }
        }
        saveAchievementsAndStats();
    }

    function checkEndGameAchievements(finalScore, correctlyAnsweredInThisGame, totalQuestionsInThisGame, jokersWereUsedInThisSpecificGame) {
        if (!achievements) return;
        if (achievements.oyunAcemisi && !achievements.oyunAcemisi.unlocked) {
            let totalGamesPlayed = Object.values(gamesPlayedStats).reduce((sum, count) => sum + count, 0) + 1;
            if (totalGamesPlayed >= achievements.oyunAcemisi.target) unlockAchievement("oyunAcemisi");
        }
    }

    function updateStreakDisplay() {
        if (!streakInfo) return;
        const lang = translations[currentLanguage];
        let currentMultiplier = 1;
        const cap = difficultySettings[selectedDifficulty].streakMultiplierCap;
        if (correctStreak >= 5) currentMultiplier = 3;
        else if (correctStreak >= 3) currentMultiplier = 2;
        currentMultiplier = Math.min(currentMultiplier, cap);
        streakInfo.innerHTML = '<span class="icon">🔥</span> ' + lang.streakLabel + ' ' + correctStreak + ' (' + currentMultiplier + 'x)';
    }

    function initializeGame() {
        if (typeof questions === 'undefined' || !questions || questions.length === 0) {
            showNotification("Hata: Soru bankası (sorular.js) yüklenemedi veya boş!", "error", 5000);
            return false;
        }
        currentQuestionIndex = 0;
        score = 0;
        correctStreak = 0;
        updateStreakDisplay();
        jokersUsedThisGame = {
            fiftyfifty: false,
            time: false,
            skip: false,
            hint: false
        };
        answerSelected = false;
        correctlyAnsweredThisGame = 0;
        totalQuestionsThisSession = 0;
        wrongAnswersCount = 0;

        jokerCounts = { ...playerData.jokers
        };

        let baseQuestions = [...questions];
        if (selectedCategory) {
            baseQuestions = baseQuestions.filter(q => q.category === selectedCategory);
            if (baseQuestions.length === 0) {
                showNotification(`"${selectedCategory}" kategorisinde soru yok!`, "error", 4000);
                return false;
            }
        }
        questionsShuffled = (currentGameMode !== 'categoryChallenge') ? baseQuestions.filter(q => q.difficulty === selectedDifficulty) : baseQuestions;
        if (questionsShuffled.length === 0) {
            showNotification(`Bu mod/zorluk için yeterli soru bulunamadı!`, "error", 5000);
            return false;
        }
        questionsShuffled.sort(() => Math.random() - 0.5);
        if (currentGameMode === 'categoryChallenge' && questionsShuffled.length > 15) {
            questionsShuffled = questionsShuffled.slice(0, 15);
        }
        masterTimerDisplay.style.display = (currentGameMode === 'timeAttack') ? 'block' : 'none';
        timerDisplay.style.display = (currentGameMode !== 'timeAttack') ? 'block' : 'none';
        if (currentGameMode === 'timeAttack') timeAttackTimeLeft = TIME_ATTACK_TOTAL_DURATION;
        updateScoreDisplay();
        updateJokerCountsDisplay();
        enableAnswerButtons();
        nextQuestionBtn.style.display = 'none';
        explanationArea.style.display = 'none';
        hintArea.style.display = 'none';
        questionText.textContent = "Sorular yükleniyor...";
        return true;
    }

    function startGameFlow() {
    playSound('click');
    if (!initializeGame()) {
        showStartScreen();
        return;
    }
    stopMusic('menuMusic');
    playSound('gameMusic', true);

    document.body.classList.add('quiz-active');

    startScreen.style.display = 'none';
    categorySelectionScreen.style.display = 'none';
    questionPage.style.display = 'block';
    jokersArea.style.display = 'flex';
    if (currentGameMode === 'timeAttack') startMasterTimer();
    loadQuestion();
}

    function startMasterTimer() {
        if (timeAttackMasterInterval) clearInterval(timeAttackMasterInterval);
        updateMasterTimerDisplay();
        timeAttackMasterInterval = setInterval(() => {
    timeAttackTimeLeft--;
    updateMasterTimerDisplay();

    if (timeAttackTimeLeft === 7) {
        playSound('timeUp');
    }

    if (timeAttackTimeLeft <= 0) {
        clearInterval(timeAttackMasterInterval);
        masterTimerDisplay.textContent = "Süre Doldu!";
        endGame();
    }
}, 1000);
    }

    function updateMasterTimerDisplay() {
        if (masterTimerDisplay && typeof timeAttackTimeLeft !== 'undefined') {
            const minutes = Math.floor(timeAttackTimeLeft / 60);
            const seconds = timeAttackTimeLeft % 60;
            masterTimerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }
    }

    function startQuestionTimer() {
        if (questionTimerInterval) clearInterval(questionTimerInterval);
        if (currentGameMode === 'timeAttack') {
            timerDisplay.style.display = 'none';
            return;
        }
        timerDisplay.style.display = 'block';
        timeLeft = difficultySettings[selectedDifficulty]?.time || 20;
        timerDisplay.textContent = timeLeft;
        questionTimerInterval = setInterval(() => {
    timeLeft--;
    timerDisplay.textContent = timeLeft;
    
    if (timeLeft === 7) {
        playSound('timeUp');
    }

    if (timeLeft <= 0) {
        clearInterval(questionTimerInterval);
        handleTimeUp();
    }
}, 1000);
    }

    function stopQuestionTimer() {
        clearInterval(questionTimerInterval);
    }

    function handleTimeUp() {
        if (answerSelected) return;
        answerSelected = true;
        disableAnswerButtons();
        const currentQData = questionsShuffled[currentQuestionIndex];
        if (currentQData) {
            explanationArea.innerHTML = `Süre doldu! Doğru Cevap: <strong>${currentQData.answer}</strong><br>${currentQData.explanation || ''}`;
            explanationArea.style.display = 'block';
        } else {
            explanationArea.innerHTML = `Süre doldu!`;
        }
        correctStreak = 0;
        updateStreakDisplay();
        if (currentGameMode === 'survival') {
            endGame();
            return;
        }
        if (currentQuestionIndex < questionsShuffled.length - 1) {
            if (currentGameMode !== 'timeAttack' || (currentGameMode === 'timeAttack' && timeAttackTimeLeft > 0)) {
                nextQuestionBtn.style.display = 'block';
            } else {
                endGame();
            }
        } else {
            endGame();
        }
    }

    function loadQuestion() {
        jokersUsedThisQuestion = {
            fiftyFifty: false,
            time: false,
            skip: false,
            hint: false
        };
        answerSelected = false;
        enableAnswerButtons();
        updateJokerCountsDisplay();
        hintArea.style.display = 'none';
        hintArea.textContent = '';
        explanationArea.style.display = 'none';
        explanationArea.textContent = '';
        nextQuestionBtn.style.display = 'none';
        if (currentQuestionIndex >= questionsShuffled.length) {
            endGame();
            return;
        }

        const questionData = questionsShuffled[currentQuestionIndex];
        const questionLangData = questionData.text[currentLanguage] || questionData.text.tr;

        totalQuestionsThisSession = currentQuestionIndex + 1;

        const oldMenuClasses = Object.values(categoryClassMap);
        const newQuestionScreenClasses = Object.values(questionScreenBgMap);
        questionPageContainer.classList.remove(...oldMenuClasses, ...newQuestionScreenClasses, 'bg-default');

        const newBgClass = questionScreenBgMap[questionData.category];
        if (newBgClass) {
            questionPageContainer.classList.add(newBgClass);
        } else {
            questionPageContainer.classList.add('bg-default');
        }

        questionText.textContent = questionLangData.question;

        const lang = translations[currentLanguage];
        const categoryKey = `category_${questionData.category.replace(/ /g, '_').replace(/&/g, 've')}`;
        const translatedCategoryName = lang[categoryKey] || questionData.category;
        categoryInfo.innerHTML = `<span class="icon">🏷️</span> ${lang.categoryLabel} ${translatedCategoryName}`;

        answerOptionsContainer.innerHTML = '';
        const shuffledOptions = [...questionLangData.options].sort(() => Math.random() - 0.5);
        shuffledOptions.forEach(option => {
            const button = document.createElement('button');
            button.className = 'answer-btn';
            button.textContent = option;
            safelySetClickListener(button, () => selectAnswer(button, option, questionData));
            answerOptionsContainer.appendChild(button);
        });

        startQuestionTimer();
    }

    function selectAnswer(button, selectedAnswerText, questionData) {
        if (answerSelected) return;
        answerSelected = true;

        const trData = questionData.text.tr;
        const currentLangData = questionData.text[currentLanguage] || trData;
        const explanation = currentLangData.explanation;
        const category = questionData.category;

        const correctIndex = trData.options.indexOf(trData.answer);
        const correctAnswerTextInCurrentLang = currentLangData.options[correctIndex];

        let isCorrect = selectedAnswerText === correctAnswerTextInCurrentLang;

        const timeLeftWhenAnswered = timeLeft;
        if (currentGameMode !== 'timeAttack') stopQuestionTimer();
        disableAnswerButtons();

        let pointsEarnedThisTurn = 0;
        const currentDifficultySetting = difficultySettings[selectedDifficulty];
        const lang = translations[currentLanguage];

        if (isCorrect) {
    playSound('correct');
    button.classList.add('correct');
    correctStreak++;
    totalCorrectAnswersOverall++;
    correctlyAnsweredThisGame++;
    
    let pointsEarnedThisTurn = 0;
    
    switch (currentGameMode) {
        case 'categoryChallenge':
            pointsEarnedThisTurn = 2;
            break;

        case 'classic':
            let baseScore = difficultySettings[selectedDifficulty].baseScore;
            let streakMultiplier = 1 + (correctStreak / 10); 
            pointsEarnedThisTurn = Math.round(baseScore * streakMultiplier);
            break;

        case 'timeAttack':
            pointsEarnedThisTurn = 3;
            break;

        case 'survival':
            pointsEarnedThisTurn = 1 + correctStreak;
            break;
    }

    score += pointsEarnedThisTurn;
    updateScoreDisplay();
    checkAllAchievements(category, pointsEarnedThisTurn, timeLeftWhenAnswered);

} else {
            playSound('wrong');
            button.classList.add('incorrect');
            Array.from(answerOptionsContainer.children).forEach(btn => {
                if (btn.textContent === correctAnswerTextInCurrentLang) btn.classList.add('correct');
            });
            correctStreak = 0;
            checkAllAchievements(category, 0, timeLeftWhenAnswered);

            if (currentGameMode === 'classic') {
                wrongAnswersCount++;
                if (wrongAnswersCount >= 4) {
                    const finalExplanation = lang.tooManyWrongAnswers || "4 wrong answers. Game over!";
                    explanationArea.innerHTML = `<strong>${finalExplanation}</strong>`;
                    explanationArea.style.display = 'block';
                    setTimeout(endGame, 2000);
                    return;
                }
            }

            if (currentGameMode === 'survival') {
                if (explanationArea && explanation) {
                    const wrongLabel = lang.wrongLabel || 'Wrong!';
                    explanationArea.innerHTML = '<strong>' + wrongLabel + '</strong><br>' + (explanation || '');
                    explanationArea.style.display = 'block';
                }
                setTimeout(endGame, 1500);
                return;
            }
        }

        updateStreakDisplay();

        if (explanationArea && explanation) {
            const correctLabel = lang.correctLabel || 'Correct!';
            const wrongLabel = lang.wrongLabel || 'Wrong!';
            explanationArea.innerHTML = '<strong>' + (isCorrect ? correctLabel : wrongLabel) + '</strong><br>' + (explanation || '');
            explanationArea.style.display = 'block';
        }

        if (currentQuestionIndex < questionsShuffled.length - 1) {
            if (currentGameMode !== 'timeAttack' || (currentGameMode === 'timeAttack' && timeAttackTimeLeft > 0)) {
                nextQuestionBtn.style.display = 'block';
            } else {
                setTimeout(endGame, 1500);
            }
        } else {
            setTimeout(endGame, 1500);
        }
    }

    function moveToNextQuestion() {
        playSound('click');
        currentQuestionIndex++;
        loadQuestion();
    }

    function updateScoreDisplay() {
        if (scoreInfo) {
            const lang = translations[currentLanguage];
            if (currentGameMode === 'timeAttack') {
                scoreInfo.innerHTML = '<span class="icon">✔️</span> ' + lang.correctLabel + ' ' + score;
            } else {
                scoreInfo.innerHTML = '<span class="icon">⭐</span> ' + lang.scoreLabel + ' ' + score;
            }
        }
    }

    function updateJokerCountsDisplay() {
        const lang = translations[currentLanguage];
        const keyMap = {
            joker5050: "joker5050",
            jokerTime: "jokerTime",
            jokerSkip: "jokerSkip",
            jokerHint: "jokerHint"
        };
        const typeMap = {
            joker5050: "fiftyFifty",
            jokerTime: "time",
            jokerSkip: "skip",
            jokerHint: "hint"
        };

        Object.keys(jokerButtons).forEach(btnKey => {
            const jokerBtn = jokerButtons[btnKey];
            if (!jokerBtn) return;

            const jokerType = typeMap[btnKey];
            const translatedText = lang[keyMap[btnKey]] || jokerType;
            const count = jokerCounts ? (jokerCounts[jokerType] || 0) : 0;

            const infoLine = jokerBtn.querySelector('.joker-info-line');
            if (infoLine) {
                infoLine.innerHTML = translatedText + ' (' + count + ')';
            }

            let isDisabled = count <= 0 || answerSelected || jokersUsedThisQuestion[jokerType];
            if (btnKey === 'joker5050' && !isDisabled) {
                const currentQ = questionsShuffled[currentQuestionIndex];
                if (currentQ && currentQ.text && currentQ.text.tr && currentQ.text.tr.options) {
                    if (currentQ.text.tr.options.length <= 2) {
                        isDisabled = true;
                    }
                } else {
                    isDisabled = true;
                }
            }
            jokerBtn.disabled = isDisabled;
            jokerBtn.classList.toggle('joker-used', count <= 0);
        });
    }

    function disableAnswerButtons() {
        if (answerOptionsContainer) Array.from(answerOptionsContainer.children).forEach(button => button.disabled = true);
    }

    function enableAnswerButtons() {
        if (answerOptionsContainer) Array.from(answerOptionsContainer.children).forEach(button => {
            button.disabled = false;
            button.style.visibility = 'visible';
            button.classList.remove('correct', 'incorrect');
        });
    }

function acilStop() {
    if (questionTimerInterval) {
        clearInterval(questionTimerInterval);
        questionTimerInterval = null;
    }
    if (timeAttackMasterInterval) {
        clearInterval(timeAttackMasterInterval);
        timeAttackMasterInterval = null;
    }

    Object.values(audioElements).forEach(audio => {
        if (audio && !audio.paused) {
            audio.pause();
            audio.currentTime = 0;
        }
    });

    stopMusic('gameMusic');
}


    function showStartScreen() {
    acilStop();

    playSound('menuMusic', true);
    document.body.classList.remove('quiz-active'); 

    startScreen.style.display = 'block';
    questionPage.style.display = 'none';
    categorySelectionScreen.style.display = 'none';
    
    const pagesToHide = ['scoreboardPage', 'settingsPage', 'shopPage', 'profileModal'];
    pagesToHide.forEach(pageId => {
        const page = document.getElementById(pageId);
        if(page) page.style.display = 'none';
    });
}

    function calculateEarnedGold() {
    const goldRewardMatrix = {
        easy: {
            classic: 2,
            categoryChallenge: 0, 
            timeAttack: 1,
            survival: 3
        },
        medium: {
            classic: 3,
            categoryChallenge: 0, 
            timeAttack: 2,
            survival: 4
        },
        hard: {
            classic: 4,
            categoryChallenge: 0, 
            timeAttack: 2,
            survival: 5
        }
    };

    const goldPerCorrect = goldRewardMatrix[selectedDifficulty][currentGameMode] || 0;

    const totalGold = correctlyAnsweredThisGame * goldPerCorrect;
    
    return Math.max(0, totalGold);
}


   function endGame() {
    acilStop();
    
    lastPlayedMode = currentGameMode;

    playerData.difficultiesCompleted[selectedDifficulty] = true;
    if (!achievements.maceraciRuh.unlocked && 
        playerData.difficultiesCompleted.easy && 
        playerData.difficultiesCompleted.medium && 
        playerData.difficultiesCompleted.hard) {
        unlockAchievement('maceraciRuh');
    }

    if (!achievements.zorluZeka.unlocked &&
        currentGameMode === 'classic' &&
        selectedDifficulty === 'hard' &&
        score >= achievements.zorluZeka.targetScore) {
        unlockAchievement('zorluZeka');
    }


if (correctlyAnsweredThisGame > 0) {
    let xpGained = 0;

    if (currentGameMode === 'categoryChallenge') {
        xpGained = correctlyAnsweredThisGame * 2;
    } else {
        xpGained = correctlyAnsweredThisGame * 5;
    }
    
    playerData.xp += xpGained;
    
    
    checkAndApplyLevelUp();
    updatePlayerUIDisplay();  
    savePlayerData();
}

    const goldEarned = calculateEarnedGold(); 

    if (goldEarned > 0) {
        addGold(goldEarned);
        showNotification(`Tebrikler, ${goldEarned} altın kazandınız! 💰`, 'success', 4000);
    }

    stopQuestionTimer();
    if (timeAttackMasterInterval) clearInterval(timeAttackMasterInterval);
    checkEndGameAchievements(score, correctlyAnsweredThisGame, totalQuestionsThisSession, Object.values(jokersUsedThisGame).some(used => used));

    const lang = translations[currentLanguage];
    const difficultyName = lang[`difficulty${selectedDifficulty.charAt(0).toUpperCase() + selectedDifficulty.slice(1)}`] || difficultySettings[selectedDifficulty].name;

    let endMessage;
    if (currentGameMode === 'timeAttack') {
        endMessage = `${lang.timeUp} (${difficultyName})<br>${lang.totalCorrect} ${correctlyAnsweredThisGame}`;
    } else if (currentGameMode === 'survival') {
        endMessage = `${lang.gameEnded} (${difficultyName})<br>${lang.questionsAnswered(correctlyAnsweredThisGame)} - ${lang.scoreLabel} ${score}`;
    } else {
        endMessage = `${lang.gameEnded} (${difficultyName})<br>${lang.yourScore} ${score}`;
    }

    questionText.innerHTML = endMessage;

    answerOptionsContainer.innerHTML = '';
    jokersArea.style.display = 'none';
    if (timerDisplay) timerDisplay.style.display = 'none';

    handleAutomaticScoreSaving();

    nextQuestionBtn.style.display = 'none';
    backToMenuBtn.style.display = 'block';
}

    function getWeekNumber(d) {
        d = new Date(Date.UTC(d.getFullYear(), d.getMonth(), d.getDate()));
        d.setUTCDate(d.getUTCDate() + 4 - (d.getUTCDay() || 7));
        const yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));
        return Math.ceil((((d - yearStart) / 86400000) + 1) / 7);
    }

    function checkAndPerformWeeklyReset() {
        const now = new Date();
        const isResetDay = now.getDay() === 1;
        const currentWeekIdentifier = `${now.getFullYear()}-W${getWeekNumber(now)}`;
        const lastResetWeek = localStorage.getItem('bilgiAgaciResetWeek_v1');

        if (isResetDay && lastResetWeek !== currentWeekIdentifier) {

            Object.keys(localStorage)
                .filter(key => key.startsWith('bilgiAgaciHighScores_'))
                .forEach(key => localStorage.removeItem(key));

            localStorage.setItem('bilgiAgaciResetWeek_v1', currentWeekIdentifier);

            showNotification("weeklyScoresReset", "info", 4000);
        }
    }

    function openModal(modalElement) {
    if (!modalElement) return;
    modalElement.style.display = 'block';
    playSound('click');
}

    function closeModal(modalElement) {
        if (!modalElement) return;
        modalElement.style.display = 'none';
        playSound('click');
    }

    function useJoker(jokerType) {
        if (jokerCounts[jokerType] > 0 && !answerSelected) {
            playSound('click');
            jokersUsedThisGame[jokerType.toLowerCase()] = true;
            totalJokersUsedOverall[jokerType.toLowerCase()] = (totalJokersUsedOverall[jokerType.toLowerCase()] || 0) + 1;
            playerData.jokers[jokerType]--;
            jokerCounts[jokerType]--;
            updateJokerCountsDisplay();
            checkAllAchievements();
            return true;
        }
        return false;
    }

    function handleAutomaticScoreSaving() {
    const currentScore = (currentGameMode === 'timeAttack' || currentGameMode === 'survival') ? correctlyAnsweredThisGame : score;

    if (currentScore <= 0) {
        backToMenuBtn.style.display = 'block';
        return;
    }

    const savedPlayerName = localStorage.getItem('bilgiAgaciPlayerName');

    if (savedPlayerName) {
        saveHighScore(savedPlayerName);
        backToMenuBtn.style.display = 'block';
    } else {
    openModal(namePromptModal);
    playerNameInput.value = "Oyuncu";
    backToMenuBtn.style.display = 'block';
}
}

function saveHighScore(nameToSave) {
    const playerName = (nameToSave || playerNameInput.value.trim()).slice(0, 15) || 'Oyuncu';
    localStorage.setItem('bilgiAgaciPlayerName', playerName);

    let scoreToAdd = score;

    const newScoreEntry = {
        name: playerName,
        score: scoreToAdd,
        avatar: playerData.avatar,
        mode: currentGameMode,
        difficulty: selectedDifficulty,
        timestamp: Date.now()
    };

    const allScores = JSON.parse(localStorage.getItem('bilgiAgaci_AllScores_v1')) || [];

    allScores.push(newScoreEntry);

    localStorage.setItem('bilgiAgaci_AllScores_v1', JSON.stringify(allScores));

    const lang = translations[currentLanguage];
    showNotification(lang.scoreSaved(playerName, scoreToAdd), 'success');
}

function displayHighScores(period = 'weekly') {
    const highScoresList = document.getElementById('highScoresList');
    if (!highScoresList) return;

    const allScores = JSON.parse(localStorage.getItem('bilgiAgaci_AllScores_v1')) || [];
    const now = Date.now();
    let startTime;

    switch (period) {
        case 'daily':
            startTime = now - (24 * 60 * 60 * 1000);
            break;
        case 'weekly':
            startTime = now - (7 * 24 * 60 * 60 * 1000);
            break;
        case 'monthly':
            startTime = now - (30 * 24 * 60 * 60 * 1000);
            break;
        case 'alltime':
        default:
            startTime = 0;
            break;
    }

    const periodScores = allScores.filter(score => score.timestamp >= startTime);

    const playerTotals = {};
    periodScores.forEach(entry => {
        if (!playerTotals[entry.name]) {
            playerTotals[entry.name] = {
                name: entry.name,
                score: 0,
                avatar: entry.avatar
            };
        }
        playerTotals[entry.name].score += entry.score;
    });

    const sortedPlayers = Object.values(playerTotals).sort((a, b) => b.score - a.score);

    highScoresList.innerHTML = '';
    if (sortedPlayers.length === 0) {
        const lang = translations[currentLanguage];
        highScoresList.innerHTML = `<li style="justify-content: center; color: #ccc; text-shadow: none;">${lang.noScoresYet}</li>`;
        return;
    }

    sortedPlayers.slice(0, 100).forEach((player, index) => {
        const li = document.createElement('li');
        const rank = index + 1;
        const avatarSrc = player.avatar || 'avatars/avatar1.png';

        li.innerHTML = `
            <div class="score-rank">
                <img class="score-avatar-img" src="${avatarSrc}" alt="Avatar">
                <span class="score-rank-number">${rank}.</span>
            </div>
            <span class="score-name">${player.name}</span>
            <span class="score-value">${player.score} puan</span>
        `;
        highScoresList.appendChild(li);
    });
}

    function loadSettings() {
        const savedSettings = JSON.parse(localStorage.getItem('bilgiAgaciSettings_v2'));
        if (savedSettings) settings = { ...settings,
            ...savedSettings
        };

        currentLanguage = settings.language || 'tr';
        const langRadioButton = document.querySelector(`input[name="language_select"][value="${currentLanguage}"]`);
        if (langRadioButton) {
            langRadioButton.checked = true;
        }

        if (musicVolumeSlider) musicVolumeSlider.value = settings.musicVolume * 100;
        if (sfxVolumeSlider) sfxVolumeSlider.value = settings.sfxVolume * 100;
        if (musicVolumeValue) musicVolumeValue.textContent = Math.round(settings.musicVolume * 100);
        if (sfxVolumeValue) sfxVolumeValue.textContent = Math.round(settings.sfxVolume * 100);
        if (musicMuteCheckbox) musicMuteCheckbox.checked = settings.musicMuted;
        if (sfxMuteCheckbox) sfxMuteCheckbox.checked = settings.sfxMuted;
        applyAudioSettings();
        updateUIText();
    }

    function saveSettings() {
    playSound('click');
    const selectedLang = document.querySelector('input[name="language_select"]:checked');
    if (selectedLang) settings.language = selectedLang.value;
    if (musicVolumeSlider) settings.musicVolume = musicVolumeSlider.value / 100;
    if (sfxVolumeSlider) settings.sfxVolume = sfxVolumeSlider.value / 100;
    if (musicMuteCheckbox) settings.musicMuted = musicMuteCheckbox.checked;
    if (sfxMuteCheckbox) settings.sfxMuted = sfxMuteCheckbox.checked;
    localStorage.setItem('bilgiAgaciSettings_v2', JSON.stringify(settings));
    applyAudioSettings();
    updateUIText();
    showNotification("settingsSaved", "success");
    showSettingsView('settings-main-view'); // <<<--- DOĞRUSU BU
}

    function applyAudioSettings() {
        Object.values(audioElements).forEach(audio => {
            if (audio) {
                const isMusic = audio.id === 'menuMusic' || audio.id === 'gameMusic';
                audio.volume = isMusic ? settings.musicVolume : settings.sfxVolume;
                audio.muted = isMusic ? settings.musicMuted : settings.sfxMuted;
            }
        });
    }

    function populateCategorySelection() {
        playSound('click');
        const categoryGrid = document.getElementById('categoryGrid');
        if (!categoryGrid) return;

        categoryGrid.innerHTML = '';
        const categories = [...new Set(questions.map(q => q.category))];
        if (categories.length === 0) {
            categoryGrid.innerHTML = '<p>Kategori bulunamadı.</p>';
            return;
        }

        const lang = translations[currentLanguage];

        categories.forEach(category => {
            const card = document.createElement('button');
            card.className = 'category-card';

            const bgClass = categoryClassMap[category];
            if (bgClass) {
                card.classList.add(bgClass);
            }

            const categoryKey = `category_${category.replace(/ /g, '_').replace(/&/g, 've')}`;
            const translatedCategoryName = lang[categoryKey] || category;

            const textSpan = document.createElement('span');
            textSpan.textContent = translatedCategoryName;
            card.appendChild(textSpan);

            safelySetClickListener(card, () => attemptToStartGame('categoryChallenge', category));

            categoryGrid.appendChild(card);
        });
    }

    function safelySetClickListener(element, handlerFunction) {
        if (!element) {
        return;
    }
    const eventType = 'ontouchend' in window ? 'touchend' : 'click';
    element.addEventListener(eventType, (event) => {
        if (eventType === 'touchend') {
            event.preventDefault();
        }
        handlerFunction(event);
    });
}
    
    function loadPlayerData() {
        try {
            const savedData = JSON.parse(localStorage.getItem('bilgiAgaciPlayerData_v1'));
            if (savedData && typeof savedData === 'object') {
                playerData = { ...playerData,
                    ...savedData
                };
            }
        } catch (e) {
        }

        if (!playerData.userId) {
            playerData.userId = `#${Date.now().toString().slice(-5)}${Math.random().toString(36).substr(2, 4).toUpperCase()}`;
        }

        usernameInput.value = localStorage.getItem('bilgiAgaciPlayerName') || 'Oyuncu';

        updatePlayerUIDisplay();
        startLifeRegenerationTimer();
    }

    function savePlayerData() {
        localStorage.setItem('bilgiAgaciPlayerData_v1', JSON.stringify(playerData));
    }

    function displayProfileData() {
    if (!profilePage) return;

    const currentName = localStorage.getItem('bilgiAgaciPlayerName') || 'Oyuncu';
    usernameInput.value = currentName;
    profilePic.src = playerData.avatar || 'avatars/avatar1.png';

    userIDDisplay.textContent = playerData.userId || 'ID Yok';
}

function updatePlayerUIDisplay() {
    const now = Date.now();
    const isUnlimitedActive = playerData.unlimitedLivesUntil && now < playerData.unlimitedLivesUntil;

    let livesDisplayIcon = '❤️';
    let livesDisplayText = `${playerData.lives}/${MAX_LIVES}`;
    let shopLivesDisplayText = livesDisplayText;

    if (isUnlimitedActive) {
        const remainingMs = playerData.unlimitedLivesUntil - now;
        const hours = Math.floor(remainingMs / 3600000);
        const minutes = Math.floor((remainingMs % 3600000) / 60000);
        const seconds = Math.floor((remainingMs % 60000) / 1000);
        
        livesDisplayIcon = '❤️';
        livesDisplayText = `∞ ${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;
        shopLivesDisplayText = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;

    } else if (playerData.lives === 0) {
        const nextLifeTimestamp = playerData.lastLifeRegenTimestamp + LIFE_REGEN_INTERVAL_MS;
        const remainingMsForNextLife = Math.max(0, nextLifeTimestamp - now);
        
        const totalSeconds = Math.floor(remainingMsForNextLife / 1000);
        const minutes = Math.floor(totalSeconds / 60);
        const seconds = totalSeconds % 60;

        livesDisplayIcon = '⏳';
        const countdownText = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        
        livesDisplayText = countdownText;
        shopLivesDisplayText = countdownText;
    
    } else {
        livesDisplayIcon = '❤️';
        livesDisplayText = `${playerData.lives}/${MAX_LIVES}`;
        shopLivesDisplayText = livesDisplayText;
    }

    
    if (playerLivesDisplay) {
        playerLivesDisplay.previousElementSibling.textContent = livesDisplayIcon;
        playerLivesDisplay.textContent = livesDisplayText;
    }
    if (playerGoldDisplay) {
        playerGoldDisplay.textContent = playerData.gold;
    }

    const shopLivesDisplay = document.getElementById('shopLivesDisplay');
    const shopGoldDisplay = document.getElementById('shopGoldDisplay');
    if (shopLivesDisplay) {
        shopLivesDisplay.previousElementSibling.textContent = livesDisplayIcon;
        shopLivesDisplay.textContent = shopLivesDisplayText;
    }
    if (shopGoldDisplay) {
        shopGoldDisplay.textContent = playerData.gold;
    }

    if (playerLevelDisplay) {
        playerLevelDisplay.textContent = `Sv. ${playerData.level}`;
    }
    const nextLevelXP = calculateXPForNextLevel(playerData.level);
    const xpPercentage = playerData.xp > 0 ? (playerData.xp / nextLevelXP) * 100 : 0;
    if (xpBarFill) {
        xpBarFill.style.width = `${xpPercentage}%`;
    }
    if (xpTextDisplay) {
        xpTextDisplay.textContent = `${playerData.xp} / ${nextLevelXP} XP`;
    }
}
    function startLifeRegenerationTimer() {
    setInterval(() => {
        const isUnlimitedActive = playerData.unlimitedLivesUntil && Date.now() < playerData.unlimitedLivesUntil;
        if (isUnlimitedActive || playerData.lives >= MAX_LIVES) {
            return;
        }

        const timeSinceLastRegen = Date.now() - playerData.lastLifeRegenTimestamp;

        if (timeSinceLastRegen >= LIFE_REGEN_INTERVAL_MS) {
            playerData.lives++;
            playerData.lastLifeRegenTimestamp = Date.now();
            savePlayerData();
            
        }
    }, 1000);
}

    function addGold(amount) {
        playerData.gold += amount;
        updatePlayerUIDisplay();
        savePlayerData();
    }
    function calculateXPForNextLevel(level) {
    return Math.floor(100 * Math.pow(level, 1.6));
}

function checkAndApplyLevelUp() {
    let nextLevelXP = calculateXPForNextLevel(playerData.level);
    while (playerData.xp >= nextLevelXP) {
        playerData.level++;
        playerData.xp -= nextLevelXP;
        playSound('achievement');
        showNotification(`Tebrikler! Seviye ${playerData.level} oldun! 🎉`, 'success', 4000);
        nextLevelXP = calculateXPForNextLevel(playerData.level);
    }
}

   function attemptToStartGame(mode, category = '') {
        playSound('click');

        const isUnlimitedActive = playerData.unlimitedLivesUntil && Date.now() < playerData.unlimitedLivesUntil;

        if (!isUnlimitedActive) {
            if (playerData.lives <= 0) {
                showNotification('notEnoughLives', 'error'); 
                openShop();
                return;
            }
            playerData.lives--;
        }
        
        savePlayerData();
        updatePlayerUIDisplay();

        currentGameMode = mode;
        selectedCategory = category;
        startGameFlow();
    }

    function openShop() {
        playSound('click');
        const shopGoldDisplay = document.getElementById('shopGoldDisplay');
        if (shopGoldDisplay) shopGoldDisplay.textContent = playerData.gold;
        const shopModal = document.getElementById('shopModal');
        if (shopModal) shopModal.style.display = 'flex';
    }

   function buyItem(event) {
        const targetButton = event.target;
        const itemKey = targetButton.dataset.item;
        const itemType = targetButton.dataset.type;
        const lang = translations[currentLanguage];

        if (itemKey === 'joker') {
            const cost = JOKER_PRICES[itemType];
            if (playerData.gold >= cost) {
                playerData.gold -= cost;

            if (!achievements.ilkAlisveris.unlocked) {
                unlockAchievement('ilkAlisveris');
            }

            playerData.totalGoldSpent = (playerData.totalGoldSpent || 0) + cost;
            if (!achievements.isAdami.unlocked && playerData.totalGoldSpent >= achievements.isAdami.target) {
                unlockAchievement('isAdami');
            }
                playerData.jokers[itemType]++;
                const jokerNameKey = `joker${itemType.charAt(0).toUpperCase() + itemType.slice(1)}_shop`;
                const jokerName = lang[jokerNameKey] || `${itemType} joker`;
                showNotification(lang.itemBought(jokerName), 'success');
            } else {
                showNotification('notEnoughGold', 'error');
                return;
            }
        } else if (itemKey === 'life') {
            const cost = LIFE_PRICES[itemType];
            if (playerData.gold >= cost) {
                playerData.gold -= cost;
                if (itemType === 'single') {
                    playerData.lives = Math.min(MAX_LIVES, playerData.lives + 1);
                    showNotification(lang.itemBought(lang.life_single_shop), 'success');
                } else if (itemType === 'full') {
                    playerData.lives = MAX_LIVES;
                    showNotification(lang.livesFull, 'success');
                }
            } else {
                showNotification('notEnoughGold', 'error');
                return;
            }
        } else if (itemKey === 'unlimited_life') {
            const durationInHours = parseInt(targetButton.dataset.duration, 10);
            const cost = (durationInHours === 1) ? 2000 : 5000;

            if (playerData.gold >= cost) {
                playerData.gold -= cost;
                const now = Date.now();
                const durationInMs = durationInHours * 60 * 60 * 1000;
                
                const baseTime = (playerData.unlimitedLivesUntil && playerData.unlimitedLivesUntil > now) 
                               ? playerData.unlimitedLivesUntil 
                               : now;

                playerData.unlimitedLivesUntil = baseTime + durationInMs;
                showNotification(lang.itemBought(`${durationInHours} Saat Sınırsız Can`), 'success');

            } else {
                showNotification('notEnoughGold', 'error');
                return;
            }
        }

        savePlayerData();
        updatePlayerUIDisplay();
    }

    window.onload = () => {
    const loader = document.getElementById('loader-wrapper');
    const mainContainer = document.querySelector('.container');
    
    if (loader && mainContainer) {
        setTimeout(() => {
            loader.classList.add('hidden');
            mainContainer.style.opacity = 1;
        }, 3000); 

        setTimeout(() => {
            if(loader) loader.style.display = 'none';
        }, 3800);
    }

    const startScreen = document.getElementById('startScreen');
    const questionPage = document.getElementById('questionPage');
    const categorySelectionScreen = document.getElementById('categorySelectionScreen');
    const scoreboardPage = document.getElementById('scoreboardPage');
    const settingsPage = document.getElementById('settingsPage');
    const profilePage = document.getElementById('profilePage');
    const shopModal = document.getElementById('shopModal');
    const difficultyButtons = document.querySelectorAll('.difficulty-btn');
    const startGameBtnClassic = document.getElementById('startGameBtnClassic');
    const startTimeAttackBtn = document.getElementById('startTimeAttackBtn');
    const startSurvivalBtn = document.getElementById('startSurvivalBtn');
    const startCategoryChallengeBtn = document.getElementById('startCategoryChallengeBtn');
    const scoreboardBtn = document.getElementById('scoreboardBtn');
    const settingsBtn = document.getElementById('settingsBtn');
    const profileBtn = document.getElementById('profileBtn');
    const shopBtn = document.getElementById('shopBtn');
    const backToMenuFromCatSelection = document.getElementById('backToMenuFromCatSelection');
    const backToMenuFromScores = document.getElementById('backToMenuFromScores');
    const backToMenuBtn = document.getElementById('backToMenuBtn');
    const nextQuestionBtn = document.getElementById('nextQuestionBtn');
    const saveScoreBtn = document.getElementById('saveScoreBtn');
    const saveSettingsBtnLang = document.getElementById('saveSettingsBtnLang');
    const saveSettingsBtnSound = document.getElementById('saveSettingsBtnSound');
    const resetHighScoresBtn = document.getElementById('resetHighScoresBtn');
    const resetAchievementsBtn = document.getElementById('resetAchievementsBtn');
    const resetPlayerDataBtn = document.getElementById('resetPlayerDataBtn');
    const claimDailyRewardBtn = document.getElementById('claimDailyRewardBtn');
    const rateGameBtn = document.getElementById('rateGameBtn');
    const submitQuestionBtn = document.getElementById('submitQuestionBtn');
    const feedbackBtn = document.getElementById('feedbackBtn');
    const joker5050Btn = document.getElementById('joker5050');
    const jokerTimeBtn = document.getElementById('jokerTime');
    const jokerSkipBtn = document.getElementById('jokerSkip');
    const jokerHintBtn = document.getElementById('jokerHint');
    const profilePicContainer = document.getElementById('profilePicContainer');
    const avatarSelection = document.getElementById('avatarSelection');
    const avatarOptions = document.querySelectorAll('.avatar-option');
    const usernameInput = document.getElementById('usernameInput');
    const tabButtons = document.querySelectorAll('.profile-tabs .tab-btn');
    const tabContents = document.querySelectorAll('.profile-content-wrapper .tab-content');
    const answerOptionsContainer = document.getElementById('answerOptions');
    const explanationArea = document.getElementById('explanationArea');
    const hintArea = document.getElementById('hintArea');

    let settingsViews, settingsMenuButtons, settingsBackButtons;
    if (settingsPage) {
        settingsViews = settingsPage.querySelectorAll('.settings-view');
        settingsMenuButtons = settingsPage.querySelectorAll('.settings-menu-btn');
        settingsBackButtons = settingsPage.querySelectorAll('.settings-back-btn');
    }

    function showSettingsView(viewId) {
        if (!settingsViews) return;
        settingsViews.forEach(view => { view.style.display = 'none'; });
        const viewToShow = document.getElementById(viewId);
        if (viewToShow) viewToShow.style.display = 'block';
    }

    
    safelySetClickListener(startGameBtnClassic, () => attemptToStartGame('classic'));
    safelySetClickListener(startTimeAttackBtn, () => attemptToStartGame('timeAttack'));
    safelySetClickListener(startSurvivalBtn, () => attemptToStartGame('survival'));
    
    safelySetClickListener(startCategoryChallengeBtn, () => {
    playSound('click');
    startScreen.style.display = 'none';
    populateCategorySelection();
    categorySelectionScreen.style.display = 'block';
});
    safelySetClickListener(scoreboardBtn, () => {
    playSound('click');
    startScreen.style.display = 'none';
    if (scoreboardPage) {
        scoreboardPage.style.display = 'block';
        displayHighScores('weekly'); 
        document.querySelectorAll('.leaderboard-tabs .tab-btn').forEach(btn => {
            btn.classList.toggle('active', btn.dataset.period === 'weekly');
        });
    }
});

const leaderboardTabs = document.querySelectorAll('.leaderboard-tabs .tab-btn');
leaderboardTabs.forEach(tab => {
    safelySetClickListener(tab, () => {
        playSound('click');
        leaderboardTabs.forEach(btn => btn.classList.remove('active'));
        tab.classList.add('active');
        displayHighScores(tab.dataset.period);
    });
});
    safelySetClickListener(settingsBtn, () => {
        playSound('click');
        startScreen.style.display = 'none';
        if (settingsPage) settingsPage.style.display = 'flex';
        showSettingsView('settings-main-view');
    });

    safelySetClickListener(backToMenuFromCatSelection, showStartScreen);
    safelySetClickListener(backToMenuFromScores, showStartScreen);
    safelySetClickListener(backToMenuBtn, showStartScreen);
    safelySetClickListener(backToMenuFromSettings, showStartScreen); 

    safelySetClickListener(profileBtn, () => {
    playSound('click');
    startScreen.style.display = 'none';
    if (profilePage) profilePage.style.display = 'block';
    displayProfileData();
    displayAchievements();
});

    safelySetClickListener(shopBtn, () => {
        playSound('click');
        startScreen.style.display = 'none';
        const shopPage = document.getElementById('shopPage');
        if (shopPage) {
            shopPage.style.display = 'block';
            document.getElementById('shopGoldDisplay').textContent = playerData.gold;
            
            const isUnlimitedActive = playerData.unlimitedLivesUntil && Date.now() < playerData.unlimitedLivesUntil;
            document.getElementById('shopLivesDisplay').textContent = isUnlimitedActive ? '∞' : `${playerData.lives}/${MAX_LIVES}`;
        }
    });
    safelySetClickListener(document.getElementById('backToMenuFromShop'), showStartScreen);
    
    if (difficultyButtons) {
        difficultyButtons.forEach(button => {
            safelySetClickListener(button, () => {
                playSound('click');
                selectedDifficulty = button.dataset.difficulty;
                difficultyButtons.forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');
            });
        });
    }

    if (settingsMenuButtons) {
        settingsMenuButtons.forEach(button => {
            safelySetClickListener(button, () => {
                playSound('click');
                const targetViewId = button.dataset.targetView;
                showSettingsView(targetViewId);
            });
        });
    }
    if (settingsBackButtons) {
        settingsBackButtons.forEach(button => {
            safelySetClickListener(button, () => {
                playSound('click');
                showSettingsView('settings-main-view');
            });
        });
    }

    if (saveSettingsBtnLang) {
    safelySetClickListener(saveSettingsBtnLang, saveSettings);
}
if (saveSettingsBtnSound) {
    safelySetClickListener(saveSettingsBtnSound, saveSettings);
}
    safelySetClickListener(nextQuestionBtn, moveToNextQuestion);
    safelySetClickListener(saveScoreBtn, () => {
    saveHighScore(playerNameInput.value); 
    closeModal(namePromptModal);
});

    safelySetClickListener(profilePicContainer, () => {
        playSound('click');
        if (avatarSelection) avatarSelection.style.display = avatarSelection.style.display === 'none' ? 'block' : 'none';
    });
    if (avatarOptions) {
        avatarOptions.forEach(option => {
            safelySetClickListener(option, (e) => {
                playerData.avatar = e.target.dataset.avatar;
                profilePic.src = playerData.avatar;
                savePlayerData();
                if (avatarSelection) avatarSelection.style.display = 'none';
            });
        });
    }
    if (usernameInput) {
        usernameInput.addEventListener('change', () => {
            localStorage.setItem('bilgiAgaciPlayerName', usernameInput.value);
            savePlayerData();
            showNotification("usernameSaved", "success");
        });
    }
    if (tabButtons) {
        tabButtons.forEach(button => {
            safelySetClickListener(button, () => {
                tabButtons.forEach(btn => btn.classList.remove('active'));
                if (tabContents) tabContents.forEach(content => content.classList.remove('active'));
                button.classList.add('active');
                const tabId = button.dataset.tab;
                const contentToShow = document.getElementById(`profile-${tabId}-content`);
                if (contentToShow) contentToShow.classList.add('active');
                playSound('click');
            });
        });
    }
    safelySetClickListener(backToMenuFromProfile, () => {
    if (profilePage) profilePage.style.display = 'none';
    showStartScreen();
});

    safelySetClickListener(claimDailyRewardBtn, claimDailyReward);
    

function populateAndOpenModal(modalId) {
    const modalElement = document.getElementById(modalId);
    if (!modalElement) return;

    const lang = translations[currentLanguage];

    const titleElement = modalElement.querySelector('[data-modal-title]');
    const contentElement = modalElement.querySelector('[data-modal-content]');

    if (titleElement && contentElement) {
        const titleKey = titleElement.dataset.modalTitle;
        const contentKey = contentElement.dataset.modalContent;
        titleElement.textContent = lang[titleKey] || '...';
        contentElement.innerHTML = lang[contentKey] || '<p>İçerik yüklenemedi.</p>';
    }
    const backButton = modalElement.querySelector('.modal-back-to-settings-btn');
    if (backButton) {
        
        backButton.textContent = lang['backToSettings'] || 'Ayarlara Dön';
    }
    
    openModal(modalElement);
}

document.querySelectorAll('.settings-menu-btn[data-modal-id]').forEach(button => {
    safelySetClickListener(button, () => {
        const modalId = button.dataset.modalId;
        populateAndOpenModal(modalId);
    });
});

    safelySetClickListener(joker5050Btn, () => {
        if (!useJoker('fiftyFifty') || answerSelected) return;
        jokersUsedThisQuestion.fiftyFifty = true;
        updateJokerCountsDisplay();
        const questionData = questionsShuffled[currentQuestionIndex];
        if (!questionData || !questionData.text || !questionData.text.tr) { return; }
        const trData = questionData.text.tr;
        const currentLangData = questionData.text[currentLanguage] || trData;
        if (currentLangData.options.length <= 2) { return; }
        const correctIndex = trData.options.indexOf(trData.answer);
        const correctAnswerInCurrentLang = currentLangData.options[correctIndex];
        let incorrectOptions = currentLangData.options.filter(opt => opt !== correctAnswerInCurrentLang);
        incorrectOptions.sort(() => Math.random() - 0.5);
        const optionsToHideCount = Math.max(0, currentLangData.options.length - 2);
        const optionsToHide = incorrectOptions.slice(0, optionsToHideCount);
        if (answerOptionsContainer) {
            Array.from(answerOptionsContainer.children).forEach(btn => {
                if (optionsToHide.includes(btn.textContent)) {
                    btn.style.visibility = 'hidden';
                }
            });
        }
    });
    safelySetClickListener(jokerTimeBtn, () => {
        if (currentGameMode === 'timeAttack') {
            showNotification("errorTimeJokerInTimeAttack", 'error');
            return;
        }
        if (!useJoker('time')) return;
        jokersUsedThisQuestion.time = true;
        updateJokerCountsDisplay();
        timeLeft += TIME_JOKER_BONUS;
        if (timerDisplay && timerDisplay.style.display !== 'none') timerDisplay.textContent = timeLeft;
    });
    safelySetClickListener(jokerSkipBtn, () => {
        if (!useJoker('skip') || !questionsShuffled[currentQuestionIndex] || answerSelected) return;
        jokersUsedThisQuestion.skip = true;
        updateJokerCountsDisplay();
        answerSelected = true; stopQuestionTimer(); disableAnswerButtons(); correctStreak = 0; updateStreakDisplay();
        const q = questionsShuffled[currentQuestionIndex];
        if (explanationArea && q) {
            const lang = translations[currentLanguage];
            const trData = q.text.tr;
            const currentLangData = q.text[currentLanguage] || trData;
            const correctIndex = trData.options.indexOf(trData.answer);
            const correctAnswerInCurrentLang = currentLangData.options[correctIndex];
            const skippedText = lang.questionSkipped || 'Soru pas geçildi!';
            const correctAnswerLabel = lang.correctAnswerLabel || 'Doğru Cevap:';
            explanationArea.innerHTML = skippedText + ' ' + correctAnswerLabel + ' <strong>' + correctAnswerInCurrentLang + '</strong><br>' + (currentLangData.explanation || '');
            explanationArea.style.display = 'block';
        }
        if (currentQuestionIndex < questionsShuffled.length - 1) {
            nextQuestionBtn.style.display = 'block';
        } else {
            setTimeout(endGame, 1000);
        }
    });
    safelySetClickListener(jokerHintBtn, () => {
        if (!useJoker('hint') || !questionsShuffled[currentQuestionIndex] || answerSelected) return;
        jokersUsedThisQuestion.hint = true;
        updateJokerCountsDisplay();
        const questionData = questionsShuffled[currentQuestionIndex];
        const langData = questionData.text[currentLanguage] || questionData.text.tr;
        const currentHint = langData.hint;
        const lang = translations[currentLanguage];
        if (hintArea && currentHint) {
            hintArea.textContent = `${lang.jokerHint}: ${currentHint}`;
            hintArea.style.display = 'block';
        } else if (hintArea) {
            hintArea.textContent = lang.hintUnavailable;
            hintArea.style.display = 'block';
        }
    });

    document.querySelectorAll('.modal .close-btn').forEach(closeBtn => {
        safelySetClickListener(closeBtn, () => {
            const modal = closeBtn.closest('.modal');
            if (modal) {
                closeModal(modal);
            }
        });
    });
    

document.querySelectorAll('.modal-back-to-settings-btn').forEach(button => {
    safelySetClickListener(button, () => {
        playSound('click');

        const parentModal = button.closest('.modal');
        if (parentModal) {
            closeModal(parentModal); 
        }

        const settingsPage = document.getElementById('settingsPage');
        if (settingsPage) {
            settingsPage.style.display = 'flex';
        }


        showSettingsView('settings-main-view');
    });
});


    
const shopPage = document.getElementById('shopPage');
if (shopPage) {
    safelySetClickListener(shopPage, (event) => {
        if (event.target.classList.contains('buy-btn')) {
            buyItem(event);
        }
    });
}

    if (!startScreen || !questionPage) {
        alert("Kritik oyun elementleri yüklenemedi! Sayfayı yenileyin.");
        return;
    }
    loadSettings();
    loadAchievements();
    loadPlayerData();
    checkDailyReward();
    checkAndPerformWeeklyReset();
    initializeScoreboardSwiperControls();
    setInterval(updatePlayerUIDisplay, 1000);

};
    
function updateScoreboardSwiper(newIndex) {
    const swiperContainer = document.getElementById('scoreboardSwiper');
    if (!swiperContainer) return;

    const wrapper = swiperContainer.querySelector('.swiper-wrapper');
    const slides = swiperContainer.querySelectorAll('.swiper-slide');
    const dotsContainer = swiperContainer.querySelector('.swiper-dots');
    const prevBtn = swiperContainer.querySelector('.swiper-nav.prev');
    const nextBtn = swiperContainer.querySelector('.swiper-nav.next');
    const totalSlides = slides.length;

    if (totalSlides === 0) return;

    swiperCurrentIndex = Math.max(0, Math.min(newIndex, totalSlides - 1));

    const offset = -swiperCurrentIndex * 100;
    wrapper.style.transform = `translateX(${offset}%)`;

    dotsContainer.innerHTML = '';
    for (let i = 0; i < totalSlides; i++) {
        const dot = document.createElement('span');
        dot.className = 'dot';
        if (i === swiperCurrentIndex) {
            dot.classList.add('active');
        }
        dot.dataset.index = i;
        dotsContainer.appendChild(dot);
    }

    prevBtn.classList.toggle('hidden', swiperCurrentIndex === 0);
    nextBtn.classList.toggle('hidden', swiperCurrentIndex === totalSlides - 1);

    const activeSlide = slides[swiperCurrentIndex];
    const mode = activeSlide.querySelector('.swiper-mode-btn').dataset.mode;
    displayHighScores(mode, selectedDifficulty);
}

function initializeScoreboardSwiperControls() {
    const swiperContainer = document.getElementById('scoreboardSwiper');
    if (!swiperContainer) return;

    safelySetClickListener(swiperContainer, (event) => {
        const target = event.target;
        if (target.classList.contains('next')) {
            updateScoreboardSwiper(swiperCurrentIndex + 1);
        } else if (target.classList.contains('prev')) {
            updateScoreboardSwiper(swiperCurrentIndex - 1);
        } else if (target.classList.contains('dot')) {
            const newIndex = parseInt(target.dataset.index, 10);
            updateScoreboardSwiper(newIndex);
        }
    });
}

const settingsPageContainer = document.getElementById('settingsPage');
if (settingsPageContainer) {

    const settingsViews = settingsPageContainer.querySelectorAll('.settings-view');
    const settingsMenuButtons = settingsPageContainer.querySelectorAll('.settings-menu-btn');
    const settingsBackButtons = settingsPageContainer.querySelectorAll('.settings-back-btn');

    function showSettingsView(viewId) {
        settingsViews.forEach(view => { view.style.display = 'none'; });
        const viewToShow = document.getElementById(viewId);
        if(viewToShow) viewToShow.style.display = 'block';
    }

    settingsMenuButtons.forEach(button => {
        safelySetClickListener(button, () => {
            playSound('click');
            const targetViewId = button.dataset.targetView;
            showSettingsView(targetViewId);
        });
    });

    settingsBackButtons.forEach(button => {
        safelySetClickListener(button, () => {
            playSound('click');
            showSettingsView('settings-main-view');
        });
    });
}

safelySetClickListener(settingsBtn, () => {
    openModal(settingsModal);
    showSettingsView('settings-main-view'); 
});

    const watchAdForGoldBtn = document.getElementById('watchAdForGoldBtn');
    const watchAdForLifeBtn = document.getElementById('watchAdForLifeBtn');
    const MAX_LIVES_CONST = 5;

    
    safelySetClickListener(watchAdForGoldBtn, () => {
        playSound('correct');
        const goldReward = 50;
        playerData.gold += goldReward;
        
        savePlayerData();
        updatePlayerUIDisplay();
        const shopGoldDisplay = document.getElementById('shopGoldDisplay');
        if (shopGoldDisplay) shopGoldDisplay.textContent = playerData.gold;

        showNotification(translations[currentLanguage].rewardEarned(`${goldReward} Altın`), 'success');
        
        watchAdForGoldBtn.disabled = true;
        setTimeout(() => {
            watchAdForGoldBtn.disabled = false;
        }, 30000); 
    });

    safelySetClickListener(watchAdForLifeBtn, () => {
        if (playerData.lives >= MAX_LIVES_CONST) {
            showNotification(translations[currentLanguage].livesFull, 'info');
            return;
        }

        playSound('correct');
        playerData.lives++;
        
        savePlayerData();
        updatePlayerUIDisplay();

        showNotification(translations[currentLanguage].rewardEarned(`1 Can`), 'success');
        
        watchAdForLifeBtn.disabled = true;
        setTimeout(() => {
            watchAdForLifeBtn.disabled = false;
        }, 60000); 
    });

</script>

</html>